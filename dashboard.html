<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eagle Homes | Property Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/al<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eagle Homes | Property Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- EmailJS for password reset functionality -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        // Initialize EmailJS (replace with your actual public key)
        (function(){
            emailjs.init("YOUR_PUBLIC_KEY_HERE");
        })();
    </script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8fafc; 
        }
        [x-cloak] { display: none !important; }
        .sidebar-link.active { 
            background-color: #eff6ff; 
            color: #2563eb; 
            border-right: 4px solid #2563eb; 
        }
        .sticky-header {
            position: sticky;
            top: 0;
            background: white;
            z-index: 50;
            border-bottom: 1px solid #e5e7eb;
        }
        input:focus, select:focus, button:focus {
            outline: none;
            ring: 2px solid #3b82f6;
        }
        .status-vacant { color: #ef4444; }
        .status-occupied { color: #10b981; }
        .status-landlord { color: #8b5cf6; }
        .status-staff { color: #f59e0b; }
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        .tab-active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        .property-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        @media print {
            .no-print, aside, header, .sidebar-nav, button, .sticky-header { 
                display: none !important; 
            }
            body { 
                background: white !important; 
                margin: 0; 
                padding: 0; 
            }
            #printable-area { 
                border: none !important; 
                box-shadow: none !important; 
                width: 100% !important; 
                max-width: none !important; 
                padding: 0 !important; 
                margin: 0 !important;
            }
            .printable-content { 
                border: none !important; 
                shadow: none !important; 
                width: 100% !important; 
            }
            input { 
                border: none !important; 
                background: transparent !important; 
                pointer-events: none !important; 
            }
        }
        .auth-code-input {
            letter-spacing: 0.3em;
            text-align: center;
            font-size: 1.875rem;
            font-weight: 800;
        }
    </style>
</head>
<body x-data="managementSystem()" x-init="init()" class="min-h-screen bg-gray-50">
    <!-- Sidebar -->
    <aside class="w-64 bg-white border-r border-gray-200 flex flex-col fixed h-full z-50 no-print">
        <div class="p-6 border-b border-gray-100 flex items-center gap-3">
            <div class="bg-blue-600 p-2 rounded-lg">
                <i class="fas fa-home text-white text-lg"></i>
            </div>
            <h1 class="font-black text-xl tracking-tighter text-slate-800 uppercase">Eagle Homes</h1>
        </div>

        <nav class="flex-1 p-4 space-y-2 overflow-y-auto scrollbar-thin">
            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest px-4 mb-2">Main Menu</p>
            <a href="#" @click.prevent="activeTab = 'dashboard'" 
               :class="activeTab === 'dashboard' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-tachometer-alt w-5 h-5"></i>
                Dashboard
            </a>
            <a href="#" @click.prevent="activeTab = 'tenants'" 
               :class="activeTab === 'tenants' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 text-gray-500 hover:bg-gray-50 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-users w-5 h-5"></i>
                Tenants
            </a>
            <a href="#" @click.prevent="activeTab = 'utilities'" 
               :class="activeTab === 'utilities' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 text-gray-500 hover:bg-gray-50 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-bolt w-5 h-5"></i>
                Utility Entry
            </a>
            <a href="#" @click.prevent="activeTab = 'payments'" 
               :class="activeTab === 'payments' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 text-gray-500 hover:bg-gray-50 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-university w-5 h-5"></i>
                Payments
            </a>
            <a href="#" @click.prevent="activeTab = 'reports'" 
               :class="activeTab === 'reports' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 text-gray-500 hover:bg-gray-50 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-chart-bar w-5 h-5"></i>
                Reports
            </a>
            <a href="#" @click.prevent="activeTab = 'statement'" 
               :class="activeTab === 'statement' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 text-gray-500 hover:bg-gray-50 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-file-invoice-dollar w-5 h-5"></i>
                Landlord Statement
            </a>

            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest px-4 mt-8 mb-2">Administration</p>
            <a href="#" @click.prevent="activeTab = 'properties'" 
               :class="activeTab === 'properties' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 text-gray-500 hover:bg-gray-50 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-building w-5 h-5"></i>
                Properties
            </a>
            <a href="#" @click.prevent="activeTab = 'settings'" 
               :class="activeTab === 'settings' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 text-gray-500 hover:bg-gray-50 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-cog w-5 h-5"></i>
                Settings
            </a>
        </nav>

        <div class="p-4 border-t border-gray-100 space-y-3">
            <!-- User Role Selector -->
            <div class="mb-4">
                <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Current Role</label>
                <select x-model="userRole" @change="onRoleChange()"
                        class="w-full bg-gray-50 border border-gray-200 p-2 rounded-lg text-xs font-bold outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="owner">Owner</option>
                    <option value="secretary">Secretary</option>
                </select>
                <p class="text-xs text-gray-500 mt-1" x-text="userRole === 'owner' ? 'Full edit permissions' : 'Read-only mode'"></p>
            </div>
            
            <!-- Owner Only: Credential Manager -->
            <template x-if="userRole === 'owner' && activeTab === 'settings'">
                <div class="bg-white p-4 rounded-xl border border-gray-200">
                    <h4 class="font-bold text-slate-800 mb-3 text-sm">System Credential Manager</h4>
                    <div class="space-y-3">
                        <div>
                            <p class="text-[10px] font-bold text-slate-400 uppercase">Secretary New Password</p>
                            <input type="password" id="sec_pass" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                        </div>
                        <button @click="updateSecretaryPassword()" 
                                class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-blue-700 transition">
                            Update Secretary Password
                        </button>
                    </div>
                </div>
            </template>
            
            <div class="flex items-center gap-3 px-2">
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-blue-600 text-sm"></i>
                </div>
                <div>
                    <p class="text-sm font-bold text-gray-700" x-text="userRole === 'owner' ? 'Owner' : 'Secretary'"></p>
                    <p class="text-xs text-gray-500">Logged In</p>
                </div>
            </div>
            <button @click="logout()" class="w-full text-red-500 font-bold text-sm py-2 hover:bg-red-50 rounded-lg transition flex items-center justify-center gap-2">
                <i class="fas fa-sign-out-alt"></i>
                Logout
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="ml-64 min-h-screen">
        <!-- Dashboard Tab -->
        <div x-show="activeTab === 'dashboard'" x-cloak>
            <div class="sticky-header p-8 pb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800">Property Dashboard</h2>
                        <p class="text-gray-500 font-medium">Eagle Homes Portfolio â€¢ <span class="text-blue-600 font-bold" x-text="currentMonth"></span></p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button x-show="userRole === 'owner'" 
                                @click="toggleEditMode()"
                                :class="editMode ? 'bg-amber-500 hover:bg-amber-600' : 'bg-blue-600 hover:bg-blue-700'"
                                class="text-white px-6 py-3 rounded-xl font-bold shadow-lg transition flex items-center gap-2">
                            <i :class="editMode ? 'fas fa-save' : 'fas fa-edit'"></i>
                            <span x-text="editMode ? 'Save All Changes' : 'Edit Mode'"></span>
                        </button>
                        
                        <button @click="exportData()" class="bg-gray-100 text-gray-700 px-5 py-2.5 rounded-xl font-semibold hover:bg-gray-200 transition flex items-center gap-2">
                            <i class="fas fa-download"></i>
                            Export Data
                        </button>
                        
                        <button @click="rolloverMonth()" class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-green-200 hover:bg-green-700 transition flex items-center gap-2">
                            <i class="fas fa-forward"></i>
                            Rollover Month
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-8 pt-6">
                <!-- Stats Dashboard -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-1">Total Expected Rent</p>
                                <h3 class="text-2xl font-black text-slate-800">Ksh <span x-text="formatNumber(totalRevenue)"></span></h3>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-money-bill-wave text-blue-600 text-xl"></i>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-3">Monthly expected revenue</p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-1">Total Deposits Held</p>
                                <h3 class="text-2xl font-black text-emerald-600">Ksh <span x-text="formatNumber(totalDeposits)"></span></h3>
                            </div>
                            <div class="w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-shield-alt text-emerald-600 text-xl"></i>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-3">Security deposits held</p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-1">Occupancy Rate</p>
                                <h3 class="text-2xl font-black text-purple-600"><span x-text="occupancyRate"></span>%</h3>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-chart-line text-purple-600 text-xl"></i>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4">
                            <div class="bg-purple-600 h-2.5 rounded-full" :style="{ width: occupancyRate + '%' }"></div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-1">Properties</p>
                                <h3 class="text-2xl font-black text-orange-600"><span x-text="Object.keys(properties).length"></span></h3>
                            </div>
                            <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-building text-orange-600 text-xl"></i>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-3">Total buildings managed</p>
                    </div>
                </div>

                <!-- Properties Overview -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-slate-800">Properties Overview</h3>
                        <div class="flex gap-3">
                            <select x-model="selectedBuilding" 
                                    class="bg-gray-50 border border-gray-200 p-2 rounded-lg text-sm font-medium focus:ring-2 focus:ring-blue-500">
                                <option value="">All Properties</option>
                                <template x-for="(property, name) in properties" :key="name">
                                    <option :value="name" x-text="name"></option>
                                </template>
                            </select>
                            <button x-show="userRole === 'owner'" @click="showAddPropertyModal = true"
                                    class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition flex items-center gap-2">
                                <i class="fas fa-plus"></i>
                                Add Property
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <template x-for="(property, name) in filteredProperties" :key="name">
                            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden property-card transition-all">
                                <div class="p-6">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <h4 class="font-bold text-slate-800 text-lg" x-text="name"></h4>
                                            <p class="text-sm text-gray-500" x-text="property.length + ' units'"></p>
                                        </div>
                                        <div class="flex gap-2">
                                            <button @click="viewProperty(name)" class="text-blue-600 hover:text-blue-800 p-1">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button x-show="userRole === 'owner'" @click="editProperty(name)" class="text-amber-600 hover:text-amber-800 p-1">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button x-show="userRole === 'owner'" @click="deleteProperty(name)" class="text-red-600 hover:text-red-800 p-1">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="space-y-3">
                                        <div>
                                            <p class="text-xs text-gray-400 font-medium uppercase">Total Rent</p>
                                            <p class="font-bold text-lg text-slate-800">Ksh <span x-text="formatNumber(calculatePropertyTotal(name, 'rent'))"></span></p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-400 font-medium uppercase">Occupancy</p>
                                            <div class="flex items-center gap-2">
                                                <div class="w-full bg-gray-200 rounded-full h-2">
                                                    <div class="bg-green-500 h-2 rounded-full" 
                                                         :style="{ width: calculateOccupancyRate(name) + '%' }"></div>
                                                </div>
                                                <span class="text-sm font-medium" x-text="calculateOccupancyRate(name) + '%'"></span>
                                            </div>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-400 font-medium uppercase">Vacant Units</p>
                                            <p class="font-medium text-red-600" x-text="countVacantUnits(name)"></p>
                                        </div>
                                    </div>
                                    
                                    <button @click="viewProperty(name)" 
                                            class="w-full mt-6 bg-blue-50 text-blue-600 hover:bg-blue-100 py-2 rounded-lg font-medium transition">
                                        View Details
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-xl font-bold text-slate-800 mb-6">Recent Activity</h3>
                    <div class="overflow-x-auto scrollbar-thin">
                        <table class="w-full min-w-[800px]">
                            <thead>
                                <tr class="text-xs text-gray-400 uppercase tracking-widest border-b border-gray-100">
                                    <th class="pb-3 font-bold text-left">Property</th>
                                    <th class="pb-3 font-bold text-left">Unit</th>
                                    <th class="pb-3 font-bold text-left">Tenant</th>
                                    <th class="pb-3 font-bold text-left">Activity</th>
                                    <th class="pb-3 font-bold text-left">Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="activity in recentActivity" :key="activity.id">
                                    <tr class="border-b border-gray-50 hover:bg-gray-50">
                                        <td class="py-3" x-text="activity.property"></td>
                                        <td class="py-3 font-medium" x-text="activity.unit"></td>
                                        <td class="py-3" x-text="activity.tenant"></td>
                                        <td class="py-3">
                                            <span :class="getActivityClass(activity.type)" 
                                                  class="px-2 py-1 rounded text-xs font-medium" 
                                                  x-text="activity.type"></span>
                                        </td>
                                        <td class="py-3 text-sm text-gray-500" x-text="activity.date"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tenants Management Tab -->
        <div x-show="activeTab === 'tenants'" x-cloak>
            <div class="sticky-header p-8 pb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800">Tenant Management</h2>
                        <p class="text-gray-500 font-medium">Manage all tenants across properties</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button x-show="userRole === 'owner'" @click="showAddTenantModal = true"
                                class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition flex items-center gap-2">
                            <i class="fas fa-plus"></i>
                            Add New Tenant
                        </button>
                        <button @click="printReport()" class="bg-gray-100 text-gray-700 px-5 py-2.5 rounded-xl font-semibold hover:bg-gray-200 transition flex items-center gap-2">
                            <i class="fas fa-print"></i>
                            Print Report
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-8 pt-6">
                <!-- Filter Controls -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Property</label>
                            <select x-model="selectedBuilding" @change="filterTenants()"
                                    class="w-full bg-gray-50 border border-gray-200 p-2 rounded-lg text-sm font-medium focus:ring-2 focus:ring-blue-500">
                                <option value="">All Properties</option>
                                <template x-for="(property, name) in properties" :key="name">
                                    <option :value="name" x-text="name"></option>
                                </template>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Status</label>
                            <select x-model="tenantStatusFilter" @change="filterTenants()"
                                    class="w-full bg-gray-50 border border-gray-200 p-2 rounded-lg text-sm font-medium focus:ring-2 focus:ring-blue-500">
                                <option value="">All Status</option>
                                <option value="occupied">Occupied</option>
                                <option value="vacant">Vacant</option>
                                <option value="landlord">Landlord</option>
                                <option value="staff">Staff</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Search</label>
                            <div class="relative">
                                <input type="text" x-model="tenantSearchQuery" @input="filterTenants()" 
                                       placeholder="Search tenants..." 
                                       class="w-full bg-gray-50 border border-gray-200 p-2 pl-9 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                        
                        <div class="flex items-end">
                            <button @click="resetTenantFilters()" 
                                    class="w-full bg-gray-100 text-gray-600 hover:bg-gray-200 px-4 py-2 rounded-lg font-medium transition">
                                Clear Filters
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tenants Table -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="overflow-x-auto scrollbar-thin">
                        <table class="w-full min-w-[1200px]">
                            <thead class="bg-gray-50">
                                <tr class="text-xs text-gray-400 uppercase tracking-widest border-b border-gray-100">
                                    <th class="px-6 py-4 font-bold text-left">Property</th>
                                    <th class="px-6 py-4 font-bold text-left">Unit</th>
                                    <th class="px-6 py-4 font-bold text-left">Tenant Name</th>
                                    <th class="px-6 py-4 font-bold text-left">Phone</th>
                                    <th class="px-6 py-4 font-bold text-left">Rent (Ksh)</th>
                                    <th class="px-6 py-4 font-bold text-left">Deposit</th>
                                    <th class="px-6 py-4 font-bold text-left">Status</th>
                                    <th class="px-6 py-4 font-bold text-left">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="tenant in filteredTenants" :key="tenant.id">
                                    <tr class="border-b border-gray-50 hover:bg-gray-50 transition">
                                        <td class="px-6 py-4" x-text="tenant.property"></td>
                                        <td class="px-6 py-4 font-medium" x-text="tenant.unit"></td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-2">
                                                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                                    <i class="fas fa-user text-blue-600 text-sm"></i>
                                                </div>
                                                <span x-text="tenant.name"></span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4" x-text="tenant.phone || '-'"></td>
                                        <td class="px-6 py-4 font-bold" x-text="formatNumber(tenant.rent)"></td>
                                        <td class="px-6 py-4 font-medium text-emerald-600" x-text="formatNumber(tenant.deposit)"></td>
                                        <td class="px-6 py-4">
                                            <span :class="getStatusClass(tenant.status)" 
                                                  class="px-2 py-1 rounded text-xs font-medium">
                                                <span x-text="getStatusText(tenant.status)"></span>
                                            </span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex gap-2">
                                                <button @click="editTenant(tenant)" 
                                                        class="text-blue-600 hover:text-blue-800 p-1" title="Edit">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button @click="viewTenantDetails(tenant)" 
                                                        class="text-green-600 hover:text-green-800 p-1" title="View">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button x-show="userRole === 'owner'" @click="deleteTenant(tenant)" 
                                                        class="text-red-600 hover:text-red-800 p-1" title="Delete">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                                
                                <template x-if="filteredTenants.length === 0">
                                    <tr>
                                        <td colspan="8" class="px-6 py-12 text-center">
                                            <div class="flex flex-col items-center justify-center text-gray-400">
                                                <i class="fas fa-search text-4xl mb-4"></i>
                                                <p class="text-lg font-medium">No tenants found</p>
                                                <p class="text-sm mt-2">Try adjusting your search filters</p>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <div class="px-6 py-4 border-t border-gray-100 bg-gray-50 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Showing <span x-text="filteredTenants.length"></span> of <span x-text="allTenants.length"></span> tenants
                        </div>
                        <div class="flex gap-2">
                            <button @click="tenantPage = Math.max(1, tenantPage - 1)" 
                                    :disabled="tenantPage === 1"
                                    class="px-3 py-1 rounded-lg border border-gray-300 text-gray-600 disabled:opacity-50">
                                Previous
                            </button>
                            <button @click="tenantPage = tenantPage + 1" 
                                    :disabled="tenantPage * tenantsPerPage >= filteredTenants.length"
                                    class="px-3 py-1 rounded-lg border border-gray-300 text-gray-600 disabled:opacity-50">
                                Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Utility Entry Tab -->
        <div x-show="activeTab === 'utilities'" x-cloak class="space-y-6">
            <div class="sticky-header p-8 pb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800">Monthly Utility Entry</h2>
                        <p class="text-gray-500 font-medium">Manual entry for <span class="font-bold text-blue-600" x-text="selectedBuilding"></span></p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button @click="saveUtilities()" class="bg-emerald-600 text-white px-6 py-3 rounded-xl font-bold text-sm hover:bg-emerald-700 transition shadow-lg shadow-emerald-100">
                            <i class="fas fa-save"></i>
                            Save Readings
                        </button>
                        <button @click="exportUtilityPDF()" class="bg-slate-900 text-white px-6 py-3 rounded-xl font-bold text-sm hover:bg-slate-800 transition flex items-center gap-2">
                            <i class="fas fa-file-pdf"></i>
                            Export PDF
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-8 pt-6">
                <div class="bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden printable-content">
                    <div class="hidden print:block p-8 border-b-2 border-slate-900 mb-6">
                        <h1 class="text-3xl font-black uppercase">Utility Billing Statement</h1>
                        <p class="text-slate-600 font-bold">Property: <span x-text="selectedBuilding"></span> | Date: Jan 2026</p>
                    </div>

                    <table class="w-full text-left border-collapse">
                        <thead class="bg-slate-50 text-slate-400 text-[10px] font-bold uppercase tracking-widest border-b">
                            <tr>
                                <th class="p-5 border-b">Unit No.</th>
                                <th class="p-5 border-b">Tenant Name</th>
                                <th class="p-5 border-b text-blue-600">Water (Ksh)</th>
                                <th class="p-5 border-b text-amber-600">Electricity (Ksh)</th>
                                <th class="p-5 border-b text-slate-900">Garbage (Ksh)</th>
                                <th class="p-5 border-b font-black text-right">Sub-Total</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            <template x-if="selectedBuilding && properties[selectedBuilding]">
                                <template x-for="(tenant, index) in properties[selectedBuilding]" :key="index">
                                    <tr class="hover:bg-slate-50/50">
                                        <td class="p-5 font-mono font-bold text-slate-700" x-text="tenant.unit"></td>
                                        <td class="p-5 font-bold text-slate-800" x-text="tenant.name"></td>
                                        
                                        <td class="p-5">
                                            <input type="number" x-model="tenant.water" placeholder="0" 
                                                   class="w-24 bg-blue-50/50 border border-blue-100 rounded-lg px-3 py-2 text-sm font-mono focus:ring-2 focus:ring-blue-400 outline-none no-print">
                                            <span class="hidden print:inline font-mono" x-text="Number(tenant.water || 0).toLocaleString()"></span>
                                        </td>

                                        <td class="p-5">
                                            <input type="number" x-model="tenant.electricity" placeholder="0" 
                                                   class="w-24 bg-amber-50/50 border border-amber-100 rounded-lg px-3 py-2 text-sm font-mono focus:ring-2 focus:ring-amber-400 outline-none no-print">
                                            <span class="hidden print:inline font-mono" x-text="Number(tenant.electricity || 0).toLocaleString()"></span>
                                        </td>

                                        <td class="p-5">
                                            <input type="number" x-model="tenant.garbage" placeholder="200" 
                                                   class="w-24 bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm font-mono focus:ring-2 focus:ring-slate-400 outline-none no-print">
                                            <span class="hidden print:inline font-mono" x-text="Number(tenant.garbage || 200).toLocaleString()"></span>
                                        </td>

                                        <td class="p-5 text-right font-black text-slate-900">
                                            Ksh <span x-text="formatNumber(calculateTenantTotal(tenant))"></span>
                                        </td>
                                    </tr>
                                </template>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Payments Tab -->
        <div x-show="activeTab === 'payments'" x-cloak>
            <div class="sticky-header p-8 pb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800">Payment Management</h2>
                        <p class="text-gray-500 font-medium">Track and manage all payments</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button x-show="userRole === 'owner'" @click="showAddPaymentModal = true"
                                class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition flex items-center gap-2">
                            <i class="fas fa-plus"></i>
                            Record Payment
                        </button>
                        <button @click="exportPayments()" 
                                class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition flex items-center gap-2">
                            <i class="fas fa-download"></i>
                            Export Payments
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-8 pt-6">
                <!-- Payment Summary -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2">Total Collected</p>
                        <h3 class="text-2xl font-black text-emerald-600">Ksh <span x-text="formatNumber(totalCollected)"></span></h3>
                        <p class="text-sm text-gray-500 mt-1">This month</p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2">Pending Payments</p>
                        <h3 class="text-2xl font-black text-amber-600">Ksh <span x-text="formatNumber(totalPending)"></span></h3>
                        <p class="text-sm text-gray-500 mt-1">Outstanding</p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2">Collection Rate</p>
                        <h3 class="text-2xl font-black text-blue-600" x-text="collectionRate + '%'"></h3>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div class="bg-blue-600 h-2 rounded-full" :style="{ width: collectionRate + '%' }"></div>
                        </div>
                    </div>
                </div>

                <!-- Payments Table -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="overflow-x-auto scrollbar-thin">
                        <table class="w-full min-w-[1000px]">
                            <thead class="bg-gray-50">
                                <tr class="text-xs text-gray-400 uppercase tracking-widest border-b border-gray-100">
                                    <th class="px-6 py-4 font-bold text-left">Date</th>
                                    <th class="px-6 py-4 font-bold text-left">Property</th>
                                    <th class="px-6 py-4 font-bold text-left">Unit</th>
                                    <th class="px-6 py-4 font-bold text-left">Tenant</th>
                                    <th class="px-6 py-4 font-bold text-left">Amount</th>
                                    <th class="px-6 py-4 font-bold text-left">Method</th>
                                    <th class="px-6 py-4 font-bold text-left">Status</th>
                                    <th class="px-6 py-4 font-bold text-left">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="payment in payments" :key="payment.id">
                                    <tr class="border-b border-gray-50 hover:bg-gray-50">
                                        <td class="px-6 py-4" x-text="payment.date"></td>
                                        <td class="px-6 py-4" x-text="payment.property"></td>
                                        <td class="px-6 py-4 font-medium" x-text="payment.unit"></td>
                                        <td class="px-6 py-4" x-text="payment.tenant"></td>
                                        <td class="px-6 py-4 font-bold" x-text="'Ksh ' + formatNumber(payment.amount)"></td>
                                        <td class="px-6 py-4">
                                            <span :class="getPaymentMethodClass(payment.method)" 
                                                  class="px-2 py-1 rounded text-xs font-medium" 
                                                  x-text="payment.method"></span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span :class="getPaymentStatusClass(payment.status)" 
                                                  class="px-2 py-1 rounded text-xs font-medium" 
                                                  x-text="payment.status"></span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex gap-2">
                                                <button @click="viewPayment(payment)" 
                                                        class="text-blue-600 hover:text-blue-800 p-1">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button x-show="userRole === 'owner' && payment.status === 'pending'" 
                                                        @click="markPaymentAsPaid(payment)"
                                                        class="text-green-600 hover:text-green-800 p-1">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div x-show="activeTab === 'reports'" x-cloak>
            <div class="sticky-header p-8 pb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800">Financial Reports</h2>
                        <p class="text-gray-500 font-medium">Detailed financial analysis and reports</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button @click="generateMonthlyReport()" 
                                class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition flex items-center gap-2">
                            <i class="fas fa-file-alt"></i>
                            Generate Report
                        </button>
                        <button @click="printFinancialReport()" 
                                class="bg-gray-100 text-gray-700 px-5 py-2.5 rounded-xl font-semibold hover:bg-gray-200 transition flex items-center gap-2">
                            <i class="fas fa-print"></i>
                            Print Report
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-8 pt-6">
                <!-- Report Filters -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 mb-8">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Report Type</label>
                            <select x-model="reportType" class="w-full bg-gray-50 border border-gray-200 p-2 rounded-lg text-sm font-medium">
                                <option value="monthly">Monthly Summary</option>
                                <option value="property">Property Performance</option>
                                <option value="tenant">Tenant Statement</option>
                                <option value="arrears">Arrears Report</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Start Date</label>
                            <input type="month" x-model="reportStartDate" 
                                   class="w-full bg-gray-50 border border-gray-200 p-2 rounded-lg text-sm font-medium">
                        </div>
                        
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">End Date</label>
                            <input type="month" x-model="reportEndDate" 
                                   class="w-full bg-gray-50 border border-gray-200 p-2 rounded-lg text-sm font-medium">
                        </div>
                        
                        <div class="flex items-end">
                            <button @click="generateReport()" 
                                    class="w-full bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition">
                                Generate
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Report Results -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Summary Stats -->
                    <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-xl font-bold text-slate-800 mb-6">Financial Summary</h3>
                        <div class="space-y-6">
                            <div>
                                <p class="text-sm text-gray-500 mb-2">Total Revenue</p>
                                <h4 class="text-2xl font-black text-slate-800">Ksh <span x-text="formatNumber(reportData.totalRevenue || 0)"></span></h4>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-500 mb-2">Rent Collected</p>
                                    <h4 class="text-xl font-bold text-emerald-600">Ksh <span x-text="formatNumber(reportData.rentCollected || 0)"></span></h4>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500 mb-2">Utilities Collected</p>
                                    <h4 class="text-xl font-bold text-blue-600">Ksh <span x-text="formatNumber(reportData.utilitiesCollected || 0)"></span></h4>
                                </div>
                            </div>
                            
                            <div>
                                <p class="text-sm text-gray-500 mb-2">Outstanding Arrears</p>
                                <h4 class="text-xl font-bold text-red-600">Ksh <span x-text="formatNumber(reportData.outstandingArrears || 0)"></span></h4>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Property Performance -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-xl font-bold text-slate-800 mb-6">Top Properties</h3>
                        <div class="space-y-4">
                            <template x-for="property in topProperties" :key="property.name">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="font-medium text-slate-800" x-text="property.name"></p>
                                        <p class="text-sm text-gray-500" x-text="property.occupancy + '% occupancy'"></p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-bold text-slate-800">Ksh <span x-text="formatNumber(property.revenue)"></span></p>
                                        <p class="text-xs" :class="property.collectionRate >= 90 ? 'text-emerald-600' : 'text-amber-600'">
                                            <span x-text="property.collectionRate + '%'"></span> collected
                                        </p>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Landlord Statement Tab -->
        <div x-show="activeTab === 'statement'" x-cloak>
            <div class="sticky-header p-8 pb-6 no-print">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800">Landlord Statement</h2>
                        <p class="text-gray-500 font-medium">Monthly settlement report for landlords</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button @click="printStatement()" 
                                class="bg-slate-900 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-slate-800 transition flex items-center gap-2">
                            <i class="fas fa-print"></i>
                            Print Statement
                        </button>
                        <button @click="generateStatement()" 
                                class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition flex items-center gap-2">
                            <i class="fas fa-file-alt"></i>
                            Generate Statement
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-8 pt-6">
                <!-- Landlord Statement Content -->
                <div class="max-w-6xl mx-auto bg-white p-10 shadow-2xl rounded-sm border border-slate-200" id="printable-area">
                    
                    <div class="flex justify-between items-center mb-8 no-print bg-slate-50 p-4 rounded-xl border border-slate-200">
                        <div class="flex items-center gap-4">
                            <span class="text-xs font-black text-slate-400 uppercase">Edit Mode:</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" x-model="editMode" class="sr-only peer">
                                <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        <button @click="window.print()" class="bg-slate-900 text-white px-6 py-2 rounded-lg font-bold text-sm flex items-center gap-2">
                            <i class="fas fa-print"></i>
                            Export to PDF
                        </button>
                    </div>

                    <div class="text-center mb-10 border-b-2 border-slate-100 pb-8">
                        <h1 class="text-3xl font-black text-slate-900 tracking-tighter uppercase">Eagle Homes Agencies</h1>
                        <p class="text-slate-500 font-bold uppercase tracking-[0.2em] text-[10px]">Landlord Remittance Statement</p>
                        <div class="mt-4 inline-flex gap-8 text-sm font-bold text-slate-700">
                            <span>Property: <span class="text-blue-600" x-text="selectedBuilding"></span></span>
                            <span>Month: January 2026</span>
                        </div>
                    </div>

                    <table class="w-full text-[11px] mb-8 border-collapse border border-slate-300">
                        <thead>
                            <tr class="bg-slate-100 text-slate-700 uppercase">
                                <th class="p-2 border border-slate-300">Unit</th>
                                <th class="p-2 border border-slate-300">Tenant Name</th>
                                <th class="p-2 border border-slate-300 text-right">Rent</th>
                                <th class="p-2 border border-slate-300 text-right">Amount Paid</th>
                                <th class="p-2 border border-slate-300 text-right">Deposit</th>
                                <th class="p-2 border border-slate-300 text-right">Garbage</th>
                                <th class="p-2 border border-slate-300 text-right">Balance</th>
                                <th class="p-2 border border-slate-300">Remarks</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-if="selectedBuilding && properties[selectedBuilding]">
                                <template x-for="tenant in properties[selectedBuilding]">
                                    <tr class="hover:bg-slate-50">
                                        <td class="p-2 border border-slate-300 font-bold" x-text="tenant.unit"></td>
                                        <td class="p-2 border border-slate-300">
                                            <input x-show="editMode" type="text" x-model="tenant.name" class="w-full bg-transparent outline-none">
                                            <span x-show="!editMode" x-text="tenant.name"></span>
                                        </td>
                                        <td class="p-2 border border-slate-300 text-right font-mono">
                                            <input x-show="editMode" type="number" x-model="tenant.rent" class="w-full text-right bg-transparent outline-none">
                                            <span x-show="!editMode" x-text="formatNumber(tenant.rent)"></span>
                                        </td>
                                        <td class="p-2 border border-slate-300 text-right font-mono bg-blue-50/30">
                                            <input x-show="editMode" type="number" x-model="tenant.amountPaid" class="w-full text-right bg-transparent outline-none font-bold text-blue-700">
                                            <span x-show="!editMode" class="font-bold text-blue-700" x-text="formatNumber(tenant.amountPaid || 0)"></span>
                                        </td>
                                        <td class="p-2 border border-slate-300 text-right font-mono">
                                            <input x-show="editMode" type="number" x-model="tenant.deposit" class="w-full text-right bg-transparent outline-none">
                                            <span x-show="!editMode" x-text="formatNumber(tenant.deposit || 0)"></span>
                                        </td>
                                        <td class="p-2 border border-slate-300 text-right font-mono">
                                            <input x-show="editMode" type="number" x-model="tenant.garbage" class="w-full text-right bg-transparent outline-none">
                                            <span x-show="!editMode" x-text="formatNumber(tenant.garbage || 200)"></span>
                                        </td>
                                        <td class="p-2 border border-slate-300 text-right font-mono font-bold" 
                                            :class="(tenant.rent - tenant.amountPaid) > 0 ? 'text-red-500' : 'text-emerald-600'">
                                            <span x-text="formatNumber(tenant.rent - (tenant.amountPaid || 0))"></span>
                                        </td>
                                        <td class="p-2 border border-slate-300 italic text-[10px]">
                                            <input x-show="editMode" type="text" x-model="tenant.remarks" class="w-full bg-transparent outline-none" placeholder="...">
                                            <span x-show="!editMode" x-text="tenant.remarks || '-'"></span>
                                        </td>
                                    </tr>
                                </template>
                            </template>
                        </tbody>
                    </table>

                    <div class="grid grid-cols-2 gap-10 mt-10 border-t-2 border-slate-900 pt-8">
                        <div>
                            <h3 class="font-black text-xs uppercase mb-4">Operational Expenses</h3>
                            <div class="space-y-2">
                                <template x-for="(exp, index) in expenses" :key="index">
                                    <div class="flex justify-between items-center text-xs border-b border-slate-100 pb-1">
                                        <span x-text="exp.desc"></span>
                                        <div class="flex items-center gap-4">
                                            <span class="font-mono text-red-600" x-text="'-' + formatNumber(exp.amount)"></span>
                                            <button @click="expenses.splice(index, 1)" class="no-print text-slate-300 hover:text-red-500">Ã—</button>
                                        </div>
                                    </div>
                                </template>
                                <button @click="addExpense()" class="no-print mt-4 text-[10px] font-bold text-blue-600 hover:underline">+ ADD EXPENSE ITEM</button>
                            </div>
                        </div>

                        <div class="bg-slate-50 p-6 rounded-sm border border-slate-200">
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-slate-500 font-bold uppercase text-[10px]">Total Rent Collected</span>
                                    <span class="font-bold" x-text="'Ksh ' + formatNumber(grossFromStatement)"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-500 font-bold uppercase text-[10px]">Management Commission (10%)</span>
                                    <span class="font-bold text-red-500" x-text="'- ' + formatNumber(grossFromStatement * 0.1)"></span>
                                </div>
                                <div class="flex justify-between border-b border-slate-200 pb-2">
                                    <span class="text-slate-500 font-bold uppercase text-[10px]">Total Expenses</span>
                                    <span class="font-bold text-red-500" x-text="'- ' + formatNumber(totalExpenses)"></span>
                                </div>
                                <div class="flex justify-between pt-2">
                                    <span class="font-black text-slate-900 uppercase">Net Pay to Landlord</span>
                                    <span class="font-black text-2xl text-emerald-700" x-text="'Ksh ' + formatNumber(grossFromStatement - (grossFromStatement * 0.1) - totalExpenses)"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Properties Management Tab -->
        <div x-show="activeTab === 'properties'" x-cloak>
            <div class="sticky-header p-8 pb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800">Properties Management</h2>
                        <p class="text-gray-500 font-medium">Manage all properties and buildings</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button x-show="userRole === 'owner'" @click="showAddPropertyModal = true"
                                class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition flex items-center gap-2">
                            <i class="fas fa-plus"></i>
                            Add New Property
                        </button>
                        <button @click="exportPropertiesData()" 
                                class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition flex items-center gap-2">
                            <i class="fas fa-download"></i>
                            Export Data
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-8 pt-6">
                <!-- Properties Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <template x-for="(property, name) in properties" :key="name">
                        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden property-card">
                            <div class="p-6">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <h4 class="font-bold text-slate-800 text-lg" x-text="name"></h4>
                                        <p class="text-sm text-gray-500" x-text="property.length + ' units'"></p>
                                    </div>
                                    <div class="flex gap-2">
                                        <button @click="viewProperty(name)" class="text-blue-600 hover:text-blue-800 p-1">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button x-show="userRole === 'owner'" @click="editProperty(name)" class="text-amber-600 hover:text-amber-800 p-1">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button x-show="userRole === 'owner'" @click="deleteProperty(name)" class="text-red-600 hover:text-red-800 p-1">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="space-y-3">
                                    <div>
                                        <p class="text-xs text-gray-400 font-medium uppercase">Total Rent</p>
                                        <p class="font-bold text-lg text-slate-800">Ksh <span x-text="formatNumber(calculatePropertyTotal(name, 'rent'))"></span></p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-400 font-medium uppercase">Occupancy</p>
                                        <div class="flex items-center gap-2">
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div class="bg-green-500 h-2 rounded-full" 
                                                     :style="{ width: calculateOccupancyRate(name) + '%' }"></div>
                                            </div>
                                            <span class="text-sm font-medium" x-text="calculateOccupancyRate(name) + '%'"></span>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-400 font-medium uppercase">Vacant Units</p>
                                        <p class="font-medium text-red-600" x-text="countVacantUnits(name)"></p>
                                    </div>
                                </div>
                                
                                <button @click="viewProperty(name)" 
                                        class="w-full mt-6 bg-blue-50 text-blue-600 hover:bg-blue-100 py-2 rounded-lg font-medium transition">
                                    Manage Units
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div x-show="activeTab === 'settings'" x-cloak>
            <div class="sticky-header p-8 pb-6">
                <h2 class="text-3xl font-black text-slate-800">System Settings</h2>
                <p class="text-gray-500 font-medium">Configure system preferences and settings</p>
            </div>

            <div class="p-8 pt-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- General Settings -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-xl font-bold text-slate-800 mb-6">General Settings</h3>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Company Name</label>
                                <input type="text" x-model="settings.companyName" 
                                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Default Water Rate (per mÂ³)</label>
                                <input type="number" x-model="settings.waterRate" 
                                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Default Electricity Rate (per kWh)</label>
                                <input type="number" x-model="settings.electricityRate" 
                                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Default Garbage Fee</label>
                                <input type="number" x-model="settings.garbageFee" 
                                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Commission Rate (%)</label>
                                <input type="number" x-model="commissionRate" step="0.01"
                                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <button @click="saveSettings()" 
                                    class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">
                                Save Settings
                            </button>
                        </div>
                    </div>
                    
                    <!-- System Actions -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-xl font-bold text-slate-800 mb-6">System Actions</h3>
                        <div class="space-y-4">
                            <button @click="backupData()" 
                                    class="w-full bg-emerald-50 text-emerald-700 hover:bg-emerald-100 py-3 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i class="fas fa-database"></i>
                                Backup All Data
                            </button>
                            
                            <button @click="restoreData()" 
                                    class="w-full bg-amber-50 text-amber-700 hover:bg-amber-100 py-3 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i class="fas fa-history"></i>
                                Restore from Backup
                            </button>
                            
                            <button @click="clearAllData()" 
                                    class="w-full bg-red-50 text-red-700 hover:bg-red-100 py-3 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i class="fas fa-trash"></i>
                                Clear All Data
                            </button>
                            
                            <button @click="rolloverMonth()" 
                                    class="w-full bg-purple-600 text-white hover:bg-purple-700 py-3 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i class="fas fa-forward"></i>
                                Rollover to Next Month
                            </button>
                        </div>
                    </div>

                    <!-- Security Audit Trail (Owner Only) -->
                    <template x-if="userRole === 'owner'">
                        <div class="lg:col-span-2 mt-12 bg-slate-900 rounded-3xl p-8 text-white shadow-2xl border border-slate-700">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <h3 class="text-xl font-bold flex items-center gap-2">
                                        <i class="fas fa-shield-alt text-red-500"></i>
                                        Security Audit Trail
                                    </h3>
                                    <p class="text-slate-400 text-xs mt-1">Monitors authorization codes sent to eaglehomesagencies4@gmail.com</p>
                                </div>
                                <button @click="if(confirm('Clear logs?')) { securityLogs = []; localStorage.removeItem('eagle_security_logs'); }" 
                                        class="text-[10px] font-bold bg-slate-800 px-3 py-1 rounded hover:bg-red-900 transition">
                                    CLEAR LOGS
                                </button>
                            </div>

                            <div class="overflow-hidden rounded-xl border border-slate-800">
                                <table class="w-full text-left text-sm">
                                    <thead class="bg-slate-800 text-slate-400 text-[10px] font-bold uppercase tracking-widest">
                                        <tr>
                                            <th class="p-4">Timestamp</th>
                                            <th class="p-4">Account</th>
                                            <th class="p-4">Event Description</th>
                                            <th class="p-4">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-slate-800">
                                        <template x-for="log in securityLogs">
                                            <tr class="hover:bg-slate-800/50 transition">
                                                <td class="p-4 font-mono text-xs text-slate-400" x-text="log.timestamp"></td>
                                                <td class="p-4 font-bold" x-text="log.user"></td>
                                                <td class="p-4 text-slate-300" x-text="log.event"></td>
                                                <td class="p-4">
                                                    <span class="bg-blue-900/50 text-blue-400 text-[10px] px-2 py-1 rounded font-black uppercase" x-text="log.status"></span>
                                                </td>
                                            </tr>
                                        </template>
                                        <template x-if="securityLogs.length === 0">
                                            <tr>
                                                <td colspan="4" class="p-8 text-center text-slate-500 italic text-xs">No recent security events recorded.</td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- Add/Edit Property Modal -->
    <div x-show="showAddPropertyModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-100">
                <h3 class="text-xl font-bold text-slate-800" x-text="editingProperty ? 'Edit Property' : 'Add New Property'"></h3>
            </div>
            
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Property Name</label>
                        <input type="text" x-model="newProperty.name" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Address</label>
                        <input type="text" x-model="newProperty.address" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Number of Units</label>
                        <input type="number" x-model="newProperty.units" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Property Manager</label>
                        <input type="text" x-model="newProperty.manager" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Notes</label>
                        <textarea x-model="newProperty.notes" rows="3"
                                  class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                </div>
                
                <div class="flex gap-3 mt-8">
                    <button @click="saveProperty()" 
                            class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">
                        Save Property
                    </button>
                    <button @click="showAddPropertyModal = false" 
                            class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-200 transition">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Tenant Modal -->
    <div x-show="showAddTenantModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-100">
                <h3 class="text-xl font-bold text-slate-800" x-text="editingTenant ? 'Edit Tenant' : 'Add New Tenant'"></h3>
            </div>
            
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Property</label>
                        <select x-model="newTenant.property" 
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                            <option value="">Select Property</option>
                            <template x-for="(property, name) in properties" :key="name">
                                <option :value="name" x-text="name"></option>
                            </template>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Unit Number</label>
                        <input type="text" x-model="newTenant.unit" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-slate-700 mb-2">Tenant Name</label>
                        <input type="text" x-model="newTenant.name" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Phone Number</label>
                        <input type="tel" x-model="newTenant.phone" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Email</label>
                        <input type="email" x-model="newTenant.email" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Rent Amount (Ksh)</label>
                        <input type="number" x-model="newTenant.rent" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Deposit (Ksh)</label>
                        <input type="number" x-model="newTenant.deposit" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Entry Date</label>
                        <input type="date" x-model="newTenant.entryDate" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Status</label>
                        <select x-model="newTenant.status" 
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                            <option value="occupied">Occupied</option>
                            <option value="vacant">Vacant</option>
                            <option value="landlord">Landlord Unit</option>
                            <option value="staff">Staff Unit</option>
                        </select>
                    </div>
                </div>
                
                <div class="mt-6">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Notes</label>
                    <textarea x-model="newTenant.notes" rows="3"
                              class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                
                <div class="flex gap-3 mt-8">
                    <button @click="saveTenant()" 
                            class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">
                        Save Tenant
                    </button>
                    <button @click="showAddTenantModal = false" 
                            class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-200 transition">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div x-show="showResetModal" x-cloak class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-md rounded-3xl p-8 shadow-2xl" @click.away="showResetModal = false">
            <h2 class="text-2xl font-black text-slate-900 mb-2">Reset Password</h2>
            
            <template x-if="!authCodeSent">
                <div>
                    <p class="text-slate-500 text-sm mb-6">Enter your registered email. We will notify <span class="text-blue-600 font-bold">eaglehomesagencies4@gmail.com</span> to authorize your reset.</p>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Your Email Address</label>
                            <input type="email" x-model="resetEmail" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="e.g. secretary@eaglehomes.com">
                        </div>
                        
                        <button @click="sendResetRequest()" 
                                :disabled="isSending"
                                class="w-full bg-slate-900 text-white py-4 rounded-xl font-bold hover:bg-slate-800 transition flex items-center justify-center gap-2">
                            <span x-show="!isSending">Send Reset Request</span>
                            <span x-show="isSending" class="animate-spin text-lg">â—Œ</span>
                        </button>
                        
                        <button @click="showResetModal = false" class="w-full text-slate-400 text-sm font-medium">Back to Login</button>
                    </div>
                </div>
            </template>
            
            <template x-if="authCodeSent">
                <div>
                    <p class="text-slate-500 text-sm mb-6">An authorization code has been sent to <span class="text-blue-600 font-bold">eaglehomesagencies4@gmail.com</span>. Please contact the administrator for your 6-digit code.</p>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3 text-center">Authorization Code</label>
                            <div class="flex justify-center">
                                <input type="text" 
                                       x-model="inputCode" 
                                       maxlength="6" 
                                       placeholder="000000"
                                       class="auth-code-input w-48 bg-slate-100 border-2 border-slate-200 rounded-2xl px-4 py-4 focus:border-blue-500 focus:ring-0 outline-none transition-all shadow-inner">
                            </div>
                            <p class="text-[10px] text-center text-slate-400 mt-4 italic">
                                Call the Admin at Eagle Homes Agencies if you haven't received your code.
                            </p>
                        </div>
                        
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">New Password</label>
                            <input type="password" x-model="newPassword" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Enter new password">
                        </div>
                        
                        <button @click="verifyAndReset()" 
                                class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 transition">
                            Verify & Reset Password
                        </button>
                        
                        <button @click="showResetModal = false" class="w-full text-slate-400 text-sm font-medium">Cancel</button>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Success Toast -->
    <div x-show="showToast" x-transition
         :class="toastType === 'success' ? 'bg-green-500' : 'bg-red-500'"
         class="fixed bottom-4 right-4 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-3">
        <i :class="toastType === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle'"></i>
        <span x-text="toastMessage"></span>
    </div>

    <script>
        function managementSystem() {
            return {
                // State Management
                activeTab: 'dashboard',
                userRole: 'owner',
                editMode: false,
                
                // Filter States
                selectedBuilding: '',
                selectedUnit: '',
                tenantStatusFilter: '',
                tenantSearchQuery: '',
                tenantPage: 1,
                tenantsPerPage: 20,
                
                // Password Reset States
                showResetModal: false,
                resetEmail: '',
                isSending: false,
                authCodeSent: false,
                generatedCode: '',
                inputCode: '',
                newPassword: '',
                
                // Security Logs
                securityLogs: JSON.parse(localStorage.getItem('eagle_security_logs') || '[]'),
                
                // Report States
                reportType: 'monthly',
                reportStartDate: new Date().toISOString().slice(0, 7),
                reportEndDate: new Date().toISOString().slice(0, 7),
                reportData: {},
                
                // Landlord Statement States
                expenses: JSON.parse(localStorage.getItem('eagle_expenses') || '[]'),
                commissionRate: 0.10,
                statementTenants: [],
                
                // Modal States
                showAddPropertyModal: false,
                showAddTenantModal: false,
                showAddPaymentModal: false,
                editingProperty: null,
                editingTenant: null,
                
                // New Item States
                newProperty: {
                    name: '',
                    address: '',
                    units: 0,
                    manager: '',
                    notes: ''
                },
                
                newTenant: {
                    property: '',
                    unit: '',
                    name: '',
                    phone: '',
                    email: '',
                    rent: 0,
                    deposit: 0,
                    entryDate: new Date().toISOString().slice(0, 10),
                    status: 'occupied',
                    notes: ''
                },
                
                // Toast Notification
                showToast: false,
                toastMessage: '',
                toastType: 'success',
                
                // Data Storage
                properties: {},
                payments: [],
                settings: {
                    companyName: 'Eagle Homes',
                    waterRate: 100,
                    electricityRate: 20,
                    garbageFee: 200
                },
                
                // Computed Properties
                get currentMonth() {
                    return new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                },
                
                get filteredProperties() {
                    if (!this.selectedBuilding) return this.properties;
                    return { [this.selectedBuilding]: this.properties[this.selectedBuilding] };
                },
                
                get allTenants() {
                    const allTenants = [];
                    Object.entries(this.properties).forEach(([property, units]) => {
                        units.forEach(unit => {
                            allTenants.push({
                                id: `${property}-${unit.unit}`,
                                property: property,
                                unit: unit.unit,
                                name: unit.name,
                                phone: unit.phone,
                                rent: unit.rent,
                                deposit: unit.deposit,
                                status: unit.status,
                                entryDate: unit.entryDate,
                                notes: unit.notes
                            });
                        });
                    });
                    return allTenants;
                },
                
                get filteredTenants() {
                    let filtered = this.allTenants;
                    
                    // Filter by property
                    if (this.selectedBuilding) {
                        filtered = filtered.filter(t => t.property === this.selectedBuilding);
                    }
                    
                    // Filter by status
                    if (this.tenantStatusFilter) {
                        filtered = filtered.filter(t => t.status === this.tenantStatusFilter);
                    }
                    
                    // Filter by search query
                    if (this.tenantSearchQuery) {
                        const query = this.tenantSearchQuery.toLowerCase();
                        filtered = filtered.filter(t => 
                            t.name.toLowerCase().includes(query) ||
                            t.unit.toLowerCase().includes(query) ||
                            t.property.toLowerCase().includes(query) ||
                            (t.phone && t.phone.toLowerCase().includes(query))
                        );
                    }
                    
                    // Pagination
                    const start = (this.tenantPage - 1) * this.tenantsPerPage;
                    const end = start + this.tenantsPerPage;
                    return filtered.slice(start, end);
                },
                
                get totalRevenue() {
                    return this.allTenants.reduce((sum, tenant) => sum + (tenant.rent || 0), 0);
                },
                
                get totalDeposits() {
                    return this.allTenants.reduce((sum, tenant) => sum + (tenant.deposit || 0), 0);
                },
                
                get occupancyRate() {
                    if (this.allTenants.length === 0) return 0;
                    const occupied = this.allTenants.filter(t => t.status === 'occupied').length;
                    return Math.round((occupied / this.allTenants.length) * 100);
                },
                
                get totalCollected() {
                    return this.payments.filter(p => p.status === 'paid').reduce((sum, p) => sum + p.amount, 0);
                },
                
                get totalPending() {
                    return this.allTenants.reduce((sum, tenant) => sum + tenant.rent, 0) - this.totalCollected;
                },
                
                get collectionRate() {
                    const totalRent = this.totalRevenue;
                    if (totalRent === 0) return 100;
                    return Math.round((this.totalCollected / totalRent) * 100);
                },
                
                get recentActivity() {
                    const activities = [];
                    
                    // Add tenant activities
                    this.allTenants.slice(0, 5).forEach(tenant => {
                        activities.push({
                            id: `tenant-${tenant.id}`,
                            property: tenant.property,
                            unit: tenant.unit,
                            tenant: tenant.name,
                            type: tenant.status === 'occupied' ? 'Occupied' : 'Vacant',
                            date: tenant.entryDate || 'Recent'
                        });
                    });
                    
                    // Add payment activities
                    this.payments.slice(0, 5).forEach(payment => {
                        activities.push({
                            id: `payment-${payment.id}`,
                            property: payment.property,
                            unit: payment.unit,
                            tenant: payment.tenant,
                            type: `Payment: ${payment.status}`,
                            date: payment.date
                        });
                    });
                    
                    return activities.slice(0, 10);
                },
                
                get topProperties() {
                    const propertyStats = {};
                    
                    Object.entries(this.properties).forEach(([name, units]) => {
                        const occupied = units.filter(u => u.status === 'occupied').length;
                        const total = units.length;
                        const revenue = units.reduce((sum, u) => sum + (u.rent || 0), 0);
                        
                        propertyStats[name] = {
                            name: name,
                            occupancy: total > 0 ? Math.round((occupied / total) * 100) : 0,
                            revenue: revenue,
                            collectionRate: 85
                        };
                    });
                    
                    return Object.values(propertyStats)
                        .sort((a, b) => b.revenue - a.revenue)
                        .slice(0, 5);
                },
                
                get totalExpenses() {
                    return this.expenses.reduce((sum, e) => sum + (e.amount || 0), 0);
                },
                
                get grossFromStatement() {
                    if (!this.selectedBuilding || !this.properties[this.selectedBuilding]) return 0;
                    return this.properties[this.selectedBuilding].reduce((sum, t) => sum + (Number(t.amountPaid) || 0), 0);
                },
                
                // Initialization
                init() {
                    // Load saved data from localStorage
                    const savedProperties = localStorage.getItem('eagle_properties');
                    const savedPayments = localStorage.getItem('eagle_payments');
                    const savedSettings = localStorage.getItem('eagle_settings');
                    const savedRole = localStorage.getItem('userRole');
                    const savedCommissionRate = localStorage.getItem('commissionRate');
                    
                    if (savedRole) this.userRole = savedRole;
                    if (savedSettings) this.settings = JSON.parse(savedSettings);
                    if (savedCommissionRate) this.commissionRate = parseFloat(savedCommissionRate);
                    
                    if (savedProperties) {
                        this.properties = JSON.parse(savedProperties);
                    } else {
                        this.initializeSampleData();
                    }
                    
                    if (savedPayments) {
                        this.payments = JSON.parse(savedPayments);
                    }
                },
                
                initializeSampleData() {
                    this.properties = {
                        "ROSALIA HOUSE": [
                            { unit: "1", name: "Paul Murimi", rent: 3000, deposit: 3000, phone: "0712345678", status: "occupied", entryDate: "2025-01-01", notes: "" },
                            { unit: "2", name: "Jane Mwangi", rent: 1500, deposit: 1500, phone: "0723456789", status: "occupied", entryDate: "2025-01-01", notes: "" },
                            { unit: "3", name: "John Kamau", rent: 3000, deposit: 3000, phone: "0734567890", status: "occupied", entryDate: "2025-01-01", notes: "" },
                        ],
                        "JOSPHINE NJAMBI": [
                            { unit: "1", name: "Simon Ndungu", rent: 4150, deposit: 4150, phone: "0745678901", status: "occupied", entryDate: "2025-01-01", notes: "" },
                            { unit: "2", name: "Irene Gichuki", rent: 3650, deposit: 3650, phone: "0756789012", status: "occupied", entryDate: "2025-01-01", notes: "" },
                        ]
                    };
                    
                    this.payments = [
                        { id: 1, property: "ROSALIA HOUSE", unit: "1", tenant: "Paul Murimi", amount: 3000, method: "mpesa", status: "paid", date: "2025-01-05" },
                        { id: 2, property: "ROSALIA HOUSE", unit: "2", tenant: "Jane Mwangi", amount: 1500, method: "cash", status: "paid", date: "2025-01-06" },
                        { id: 3, property: "JOSPHINE NJAMBI", unit: "1", tenant: "Simon Ndungu", amount: 4150, method: "bank", status: "paid", date: "2025-01-07" },
                    ];
                    
                    this.saveData();
                },
                
                // Property Management Functions
                viewProperty(propertyName) {
                    this.selectedBuilding = propertyName;
                    this.activeTab = 'tenants';
                },
                
                editProperty(propertyName) {
                    this.editingProperty = propertyName;
                    const property = this.properties[propertyName];
                    this.newProperty = {
                        name: propertyName,
                        address: '',
                        units: property.length,
                        manager: '',
                        notes: ''
                    };
                    this.showAddPropertyModal = true;
                },
                
                deleteProperty(propertyName) {
                    if (confirm(`Are you sure you want to delete ${propertyName}? This will also delete all tenants in this property.`)) {
                        delete this.properties[propertyName];
                        this.saveData();
                        this.showToastMessage('Property deleted successfully', 'success');
                    }
                },
                
                saveProperty() {
                    if (!this.newProperty.name.trim()) {
                        this.showToastMessage('Property name is required', 'error');
                        return;
                    }
                    
                    if (this.editingProperty && this.editingProperty !== this.newProperty.name) {
                        this.properties[this.newProperty.name] = this.properties[this.editingProperty];
                        delete this.properties[this.editingProperty];
                    } else if (!this.properties[this.newProperty.name]) {
                        this.properties[this.newProperty.name] = [];
                    }
                    
                    const currentUnits = this.properties[this.newProperty.name].length;
                    const targetUnits = parseInt(this.newProperty.units) || 0;
                    
                    if (targetUnits > currentUnits) {
                        for (let i = currentUnits + 1; i <= targetUnits; i++) {
                            this.properties[this.newProperty.name].push({
                                unit: i.toString(),
                                name: "Vacant",
                                rent: 0,
                                deposit: 0,
                                status: "vacant",
                                entryDate: "",
                                notes: ""
                            });
                        }
                    } else if (targetUnits < currentUnits) {
                        this.properties[this.newProperty.name] = this.properties[this.newProperty.name].slice(0, targetUnits);
                    }
                    
                    this.saveData();
                    this.showAddPropertyModal = false;
                    this.editingProperty = null;
                    this.newProperty = { name: '', address: '', units: 0, manager: '', notes: '' };
                    this.showToastMessage('Property saved successfully', 'success');
                },
                
                // Tenant Management Functions
                filterTenants() {
                    this.tenantPage = 1;
                },
                
                resetTenantFilters() {
                    this.selectedBuilding = '';
                    this.tenantStatusFilter = '';
                    this.tenantSearchQuery = '';
                    this.tenantPage = 1;
                },
                
                editTenant(tenant) {
                    this.editingTenant = tenant.id;
                    this.newTenant = { ...tenant };
                    this.showAddTenantModal = true;
                },
                
                viewTenantDetails(tenant) {
                    alert(`Tenant Details:\n\nName: ${tenant.name}\nProperty: ${tenant.property}\nUnit: ${tenant.unit}\nRent: Ksh ${tenant.rent}\nStatus: ${tenant.status}`);
                },
                
                deleteTenant(tenant) {
                    if (confirm(`Are you sure you want to delete ${tenant.name}?`)) {
                        const property = this.properties[tenant.property];
                        if (property) {
                            const index = property.findIndex(u => u.unit === tenant.unit);
                            if (index !== -1) {
                                property.splice(index, 1);
                                this.saveData();
                                this.showToastMessage('Tenant deleted successfully', 'success');
                            }
                        }
                    }
                },
                
                saveTenant() {
                    if (!this.newTenant.property || !this.newTenant.name.trim()) {
                        this.showToastMessage('Property and tenant name are required', 'error');
                        return;
                    }
                    
                    const property = this.properties[this.newTenant.property];
                    if (!property) {
                        this.showToastMessage('Selected property not found', 'error');
                        return;
                    }
                    
                    const existingIndex = property.findIndex(u => u.unit === this.newTenant.unit);
                    
                    if (existingIndex !== -1) {
                        property[existingIndex] = {
                            unit: this.newTenant.unit,
                            name: this.newTenant.name,
                            rent: parseFloat(this.newTenant.rent) || 0,
                            deposit: parseFloat(this.newTenant.deposit) || 0,
                            phone: this.newTenant.phone || '',
                            status: this.newTenant.status,
                            entryDate: this.newTenant.entryDate,
                            notes: this.newTenant.notes || ''
                        };
                    } else {
                        property.push({
                            unit: this.newTenant.unit,
                            name: this.newTenant.name,
                            rent: parseFloat(this.newTenant.rent) || 0,
                            deposit: parseFloat(this.newTenant.deposit) || 0,
                            phone: this.newTenant.phone || '',
                            status: this.newTenant.status,
                            entryDate: this.newTenant.entryDate,
                            notes: this.newTenant.notes || ''
                        });
                    }
                    
                    this.saveData();
                    this.showAddTenantModal = false;
                    this.editingTenant = null;
                    this.newTenant = {
                        property: '',
                        unit: '',
                        name: '',
                        phone: '',
                        email: '',
                        rent: 0,
                        deposit: 0,
                        entryDate: new Date().toISOString().slice(0, 10),
                        status: 'occupied',
                        notes: ''
                    };
                    this.showToastMessage('Tenant saved successfully', 'success');
                },
                
                // Utility Functions
                calculateTenantTotal(tenant) {
                    return (Number(tenant.rent) || 0) + 
                           (Number(tenant.water) || 0) + 
                           (Number(tenant.electricity) || 0) + 
                           (Number(tenant.garbage) || 0);
                },
                
                saveUtilities() {
                    localStorage.setItem('eagle_properties', JSON.stringify(this.properties));
                    this.showToastMessage('Utility readings saved successfully!', 'success');
                },
                
                exportUtilityPDF() {
                    window.print();
                },
                
                // Payment Functions
                markPaymentAsPaid(payment) {
                    payment.status = 'paid';
                    this.saveData();
                    this.showToastMessage('Payment marked as paid', 'success');
                },
                
                // Landlord Statement Functions
                generateStatement() {
                    this.showToastMessage('Landlord statement generated', 'success');
                },
                
                addExpense() {
                    const description = prompt("Expense Description:");
                    const amount = prompt("Amount (Ksh):");
                    if (description && amount && !isNaN(amount)) {
                        this.expenses.push({
                            desc: description,
                            amount: parseFloat(amount)
                        });
                        localStorage.setItem('eagle_expenses', JSON.stringify(this.expenses));
                        this.showToastMessage('Expense added', 'success');
                    } else if (amount && isNaN(amount)) {
                        this.showToastMessage('Please enter a valid amount', 'error');
                    }
                },
                
                printStatement() {
                    window.print();
                },
                
                saveStatement() {
                    const statementData = {
                        month: this.currentMonth,
                        property: this.selectedBuilding,
                        tenants: this.properties[this.selectedBuilding] || [],
                        expenses: this.expenses,
                        summary: {
                            totalCollected: this.grossFromStatement,
                            totalExpenses: this.totalExpenses,
                            commission: this.grossFromStatement * this.commissionRate,
                            netToLandlord: this.grossFromStatement - this.totalExpenses - (this.grossFromStatement * this.commissionRate)
                        },
                        timestamp: new Date().toISOString()
                    };
                    
                    const dataStr = JSON.stringify(statementData, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `landlord-statement-${this.currentMonth}-${this.selectedBuilding || 'all'}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    this.showToastMessage('Statement saved', 'success');
                },
                
                // Report Functions
                generateReport() {
                    this.reportData = {
                        totalRevenue: this.totalRevenue,
                        rentCollected: this.totalCollected,
                        utilitiesCollected: 0,
                        outstandingArrears: this.totalPending
                    };
                    
                    this.showToastMessage('Report generated successfully', 'success');
                },
                
                // System Functions
                toggleEditMode() {
                    if (this.userRole !== 'owner') {
                        this.showToastMessage('Only owners can edit data', 'error');
                        return;
                    }
                    
                    this.editMode = !this.editMode;
                    if (this.editMode) {
                        this.showToastMessage('Edit mode activated', 'success');
                    } else {
                        this.saveAllChanges();
                    }
                },
                
                saveAllChanges() {
                    this.saveData();
                    this.editMode = false;
                    this.showToastMessage('All changes saved successfully', 'success');
                },
                
                rolloverMonth() {
                    if (confirm('Rollover to next month? This will reset monthly data for the new period.')) {
                        Object.values(this.properties).forEach(property => {
                            property.forEach(tenant => {
                                tenant.water = '';
                                tenant.electricity = '';
                                tenant.amountPaid = 0;
                            });
                        });
                        this.showToastMessage('Month rolled over successfully', 'success');
                    }
                },
                
                saveSettings() {
                    localStorage.setItem('eagle_settings', JSON.stringify(this.settings));
                    localStorage.setItem('commissionRate', this.commissionRate.toString());
                    this.showToastMessage('Settings saved successfully', 'success');
                },
                
                updateSecretaryPassword() {
                    const newPassword = document.getElementById('sec_pass').value;
                    if (!newPassword) {
                        this.showToastMessage('Please enter a password', 'error');
                        return;
                    }
                    
                    localStorage.setItem('sec_password', newPassword);
                    document.getElementById('sec_pass').value = '';
                    this.showToastMessage('Secretary password updated!', 'success');
                },
                
                backupData() {
                    const backup = {
                        properties: this.properties,
                        payments: this.payments,
                        expenses: this.expenses,
                        settings: this.settings,
                        commissionRate: this.commissionRate,
                        timestamp: new Date().toISOString()
                    };
                    
                    const dataStr = JSON.stringify(backup, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `eagle-homes-backup-${new Date().toISOString().slice(0, 10)}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    this.showToastMessage('Backup created successfully', 'success');
                },
                
                restoreData() {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';
                    
                    input.onchange = e => {
                        const file = e.target.files[0];
                        const reader = new FileReader();
                        
                        reader.onload = (event) => {
                            try {
                                const backup = JSON.parse(event.target.result);
                                this.properties = backup.properties || {};
                                this.payments = backup.payments || [];
                                this.expenses = backup.expenses || [];
                                this.settings = backup.settings || this.settings;
                                this.commissionRate = backup.commissionRate || 0.10;
                                
                                this.saveData();
                                localStorage.setItem('eagle_expenses', JSON.stringify(this.expenses));
                                localStorage.setItem('commissionRate', this.commissionRate.toString());
                                this.showToastMessage('Data restored successfully', 'success');
                                setTimeout(() => location.reload(), 1000);
                            } catch (error) {
                                this.showToastMessage('Failed to restore backup', 'error');
                            }
                        };
                        
                        reader.readAsText(file);
                    };
                    
                    input.click();
                },
                
                clearAllData() {
                    if (confirm('WARNING: This will delete ALL data. Are you absolutely sure?')) {
                        localStorage.clear();
                        this.showToastMessage('All data cleared. Refreshing...', 'success');
                        setTimeout(() => location.reload(), 1000);
                    }
                },
                
                // Password Reset Functions
                async sendResetRequest() {
                    if (!this.resetEmail) {
                        this.showToastMessage('Please enter your email', 'error');
                        return;
                    }
                    
                    this.isSending = true;
                    this.generatedCode = Math.floor(100000 + Math.random() * 900000).toString();
                    
                    const templateParams = {
                        admin_email: 'eaglehomesagencies4@gmail.com',
                        requesting_user: this.resetEmail,
                        auth_code: this.generatedCode,
                        timestamp: new Date().toLocaleString()
                    };

                    try {
                        // Log security event
                        this.logSecurityEvent(this.resetEmail, 'Code Sent to Gmail');
                        
                        // Simulate API call (replace with actual EmailJS in production)
                        console.log('Sending reset request to eaglehomesagencies4@gmail.com...');
                        console.log('Generated Code:', this.generatedCode);
                        
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        
                        this.authCodeSent = true;
                        alert('An authorization code has been sent to the administrator. Please contact them to get your 6-digit code.');
                    } catch (error) {
                        console.error('Email Failed:', error);
                        alert('Connection Error: Could not reach the reset server.');
                    } finally {
                        this.isSending = false;
                    }
                },
                
                verifyAndReset() {
                    if (this.inputCode !== this.generatedCode) {
                        alert("Invalid Authorization Code. Please check with the Admin.");
                        return;
                    }

                    if (this.newPassword.length < 4) {
                        alert("Password must be at least 4 characters.");
                        return;
                    }

                    // Identify which user to reset
                    if (this.resetEmail.includes('owner')) {
                        localStorage.setItem('eagle_owner_pass', this.newPassword);
                    } else {
                        localStorage.setItem('eagle_sec_pass', this.newPassword);
                    }

                    // Log successful reset
                    this.logSecurityEvent(this.resetEmail, 'Password Reset Completed');
                    
                    alert("Success! Your password has been updated.");
                    
                    // Reset state
                    this.showResetModal = false;
                    this.authCodeSent = false;
                    this.inputCode = '';
                    this.newPassword = '';
                    this.resetEmail = '';
                },
                
                // Security Functions
                logSecurityEvent(email, status) {
                    const newLog = {
                        timestamp: new Date().toLocaleString(),
                        user: email,
                        event: 'Password Reset Request',
                        status: status,
                        ip: 'Authorized via eaglehomesagencies4@gmail.com'
                    };
                    this.securityLogs.unshift(newLog);
                    localStorage.setItem('eagle_security_logs', JSON.stringify(this.securityLogs));
                },
                
                // Helper Functions
                calculatePropertyTotal(propertyName, field) {
                    const property = this.properties[propertyName];
                    if (!property) return 0;
                    return property.reduce((sum, unit) => sum + (unit[field] || 0), 0);
                },
                
                calculateOccupancyRate(propertyName) {
                    const property = this.properties[propertyName];
                    if (!property || property.length === 0) return 0;
                    const occupied = property.filter(u => u.status === 'occupied').length;
                    return Math.round((occupied / property.length) * 100);
                },
                
                countVacantUnits(propertyName) {
                    const property = this.properties[propertyName];
                    if (!property) return 0;
                    return property.filter(u => u.status === 'vacant').length;
                },
                
                formatNumber(num) {
                    return new Intl.NumberFormat('en-KE').format(num);
                },
                
                getStatusClass(status) {
                    const classes = {
                        occupied: 'bg-green-100 text-green-800',
                        vacant: 'bg-red-100 text-red-800',
                        landlord: 'bg-purple-100 text-purple-800',
                        staff: 'bg-amber-100 text-amber-800'
                    };
                    return classes[status] || 'bg-gray-100 text-gray-800';
                },
                
                getStatusText(status) {
                    const texts = {
                        occupied: 'Occupied',
                        vacant: 'Vacant',
                        landlord: 'Landlord',
                        staff: 'Staff'
                    };
                    return texts[status] || status;
                },
                
                getPaymentMethodClass(method) {
                    const classes = {
                        mpesa: 'bg-green-100 text-green-800',
                        bank: 'bg-blue-100 text-blue-800',
                        cash: 'bg-emerald-100 text-emerald-800'
                    };
                    return classes[method.toLowerCase()] || 'bg-gray-100 text-gray-800';
                },
                
                getPaymentStatusClass(status) {
                    const classes = {
                        paid: 'bg-green-100 text-green-800',
                        pending: 'bg-amber-100 text-amber-800',
                        overdue: 'bg-red-100 text-red-800'
                    };
                    return classes[status.toLowerCase()] || 'bg-gray-100 text-gray-800';
                },
                
                getActivityClass(type) {
                    if (type.includes('Payment') || type.includes('paid')) {
                        return 'bg-green-100 text-green-800';
                    } else if (type.includes('Occupied')) {
                        return 'bg-blue-100 text-blue-800';
                    } else if (type.includes('Vacant')) {
                        return 'bg-red-100 text-red-800';
                    } else {
                        return 'bg-gray-100 text-gray-800';
                    }
                },
                
                // Data Persistence
                saveData() {
                    localStorage.setItem('eagle_properties', JSON.stringify(this.properties));
                    localStorage.setItem('eagle_payments', JSON.stringify(this.payments));
                    localStorage.setItem('eagle_settings', JSON.stringify(this.settings));
                    localStorage.setItem('userRole', this.userRole);
                },
                
                exportData() {
                    const data = {
                        properties: this.properties,
                        tenants: this.allTenants,
                        payments: this.payments,
                        expenses: this.expenses,
                        settings: this.settings,
                        timestamp: new Date().toISOString()
                    };
                    
                    const dataStr = JSON.stringify(data, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `eagle-homes-data-${new Date().toISOString().slice(0, 10)}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    this.showToastMessage('Data exported successfully', 'success');
                },
                
                exportPropertiesData() {
                    this.exportData();
                },
                
                exportPayments() {
                    const data = {
                        payments: this.payments,
                        summary: {
                            totalCollected: this.totalCollected,
                            totalPending: this.totalPending,
                            collectionRate: this.collectionRate
                        },
                        timestamp: new Date().toISOString()
                    };
                    
                    const dataStr = JSON.stringify(data, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `payments-data-${new Date().toISOString().slice(0, 10)}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    this.showToastMessage('Payments exported', 'success');
                },
                
                generateMonthlyReport() {
                    this.generateReport();
                },
                
                printReport() {
                    window.print();
                },
                
                printFinancialReport() {
                    this.generateReport();
                    setTimeout(() => window.print(), 500);
                },
                
                // User Management
                onRoleChange() {
                    localStorage.setItem('userRole', this.userRole);
                    this.showToastMessage(`Switched to ${this.userRole} role`, 'success');
                },
                
                logout() {
                    if (confirm('Are you sure you want to logout?')) {
                        localStorage.removeItem('userRole');
                        window.location.href = 'index.html';
                    }
                },
                
                // Toast Notification
                showToastMessage(message, type = 'success') {
                    this.toastMessage = message;
                    this.toastType = type;
                    this.showToast = true;
                    
                    setTimeout(() => {
                        this.showToast = false;
                    }, 3000);
                }
            };
        }
    </script>
</body>
</html>pinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8fafc; 
        }
        [x-cloak] { display: none !important; }
        .sidebar-link.active { 
            background-color: #eff6ff; 
            color: #2563eb; 
            border-right: 4px solid #2563eb; 
        }
        .sticky-header {
            position: sticky;
            top: 0;
            background: white;
            z-index: 50;
            border-bottom: 1px solid #e5e7eb;
        }
        input:focus, select:focus, button:focus {
            outline: none;
            ring: 2px solid #3b82f6;
        }
        .status-vacant { color: #ef4444; }
        .status-occupied { color: #10b981; }
        .status-landlord { color: #8b5cf6; }
        .status-staff { color: #f59e0b; }
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        .tab-active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        .property-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; }
            #printable-area { 
                border: none !important; 
                box-shadow: none !important; 
                width: 100% !important; 
                max-width: none !important; 
                padding: 0 !important; 
                margin: 0 !important;
            }
        }
    </style>
</head>
<body x-data="managementSystem()" x-init="init()" class="min-h-screen bg-gray-50">
    <!-- Sidebar -->
    <aside class="w-64 bg-white border-r border-gray-200 flex flex-col fixed h-full z-50 no-print">
        <div class="p-6 border-b border-gray-100 flex items-center gap-3">
            <div class="bg-blue-600 p-2 rounded-lg">
                <i class="fas fa-home text-white text-lg"></i>
            </div>
            <h1 class="font-black text-xl tracking-tighter text-slate-800 uppercase">Eagle Homes</h1>
        </div>

        <nav class="flex-1 p-4 space-y-2 overflow-y-auto scrollbar-thin">
            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest px-4 mb-2">Main Menu</p>
            <a href="#" @click.prevent="activeTab = 'dashboard'" 
               :class="activeTab === 'dashboard' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-tachometer-alt w-5 h-5"></i>
                Dashboard
            </a>
            <a href="#" @click.prevent="activeTab = 'tenants'" 
               :class="activeTab === 'tenants' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 text-gray-500 hover:bg-gray-50 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-users w-5 h-5"></i>
                Tenants
            </a>
            <a href="#" @click.prevent="activeTab = 'utility'" 
               :class="activeTab === 'utility' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 text-gray-500 hover:bg-gray-50 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-bolt w-5 h-5"></i>
                Utility Entry
            </a>
            <a href="#" @click.prevent="activeTab = 'payments'" 
               :class="activeTab === 'payments' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 text-gray-500 hover:bg-gray-50 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-university w-5 h-5"></i>
                Payments
            </a>
            <a href="#" @click.prevent="activeTab = 'reports'" 
               :class="activeTab === 'reports' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 text-gray-500 hover:bg-gray-50 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-chart-bar w-5 h-5"></i>
                Reports
            </a>
            <a href="#" @click.prevent="activeTab = 'statement'" 
               :class="activeTab === 'statement' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 text-gray-500 hover:bg-gray-50 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-file-invoice-dollar w-5 h-5"></i>
                Landlord Statement
            </a>

            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest px-4 mt-8 mb-2">Administration</p>
            <a href="#" @click.prevent="activeTab = 'properties'" 
               :class="activeTab === 'properties' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 text-gray-500 hover:bg-gray-50 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-building w-5 h-5"></i>
                Properties
            </a>
            <a href="#" @click.prevent="activeTab = 'settings'" 
               :class="activeTab === 'settings' ? 'sidebar-link active' : ''"
               class="flex items-center gap-3 px-4 py-3 text-gray-500 hover:bg-gray-50 rounded-xl text-sm font-semibold transition">
                <i class="fas fa-cog w-5 h-5"></i>
                Settings
            </a>
        </nav>

        <div class="p-4 border-t border-gray-100 space-y-3">
            <!-- User Role Selector -->
            <div class="mb-4">
                <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Current Role</label>
                <select x-model="userRole" @change="onRoleChange()"
                        class="w-full bg-gray-50 border border-gray-200 p-2 rounded-lg text-xs font-bold outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="owner">Owner</option>
                    <option value="secretary">Secretary</option>
                </select>
                <p class="text-xs text-gray-500 mt-1" x-text="userRole === 'owner' ? 'Full edit permissions' : 'Read-only mode'"></p>
            </div>
            
            <!-- Owner Only: Credential Manager -->
            <template x-if="userRole === 'owner' && activeTab === 'settings'">
                <div class="bg-white p-4 rounded-xl border border-gray-200">
                    <h4 class="font-bold text-slate-800 mb-3 text-sm">System Credential Manager</h4>
                    <div class="space-y-3">
                        <div>
                            <p class="text-[10px] font-bold text-slate-400 uppercase">Secretary New Password</p>
                            <input type="password" id="sec_pass" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                        </div>
                        <button @click="updateSecretaryPassword()" 
                                class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-blue-700 transition">
                            Update Secretary Password
                        </button>
                    </div>
                </div>
            </template>
            
            <div class="flex items-center gap-3 px-2">
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-blue-600 text-sm"></i>
                </div>
                <div>
                    <p class="text-sm font-bold text-gray-700" x-text="userRole === 'owner' ? 'Owner' : 'Secretary'"></p>
                    <p class="text-xs text-gray-500">Logged In</p>
                </div>
            </div>
            <button @click="logout()" class="w-full text-red-500 font-bold text-sm py-2 hover:bg-red-50 rounded-lg transition flex items-center justify-center gap-2">
                <i class="fas fa-sign-out-alt"></i>
                Logout
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="ml-64 min-h-screen">
        <!-- Dashboard Tab -->
        <div x-show="activeTab === 'dashboard'" x-cloak>
            <div class="sticky-header p-8 pb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800">Property Dashboard</h2>
                        <p class="text-gray-500 font-medium">Eagle Homes Portfolio â€¢ <span class="text-blue-600 font-bold" x-text="currentMonth"></span></p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button x-show="userRole === 'owner'" 
                                @click="toggleEditMode()"
                                :class="editMode ? 'bg-amber-500 hover:bg-amber-600' : 'bg-blue-600 hover:bg-blue-700'"
                                class="text-white px-6 py-3 rounded-xl font-bold shadow-lg transition flex items-center gap-2">
                            <i :class="editMode ? 'fas fa-save' : 'fas fa-edit'"></i>
                            <span x-text="editMode ? 'Save All Changes' : 'Edit Mode'"></span>
                        </button>
                        
                        <button @click="exportData()" class="bg-gray-100 text-gray-700 px-5 py-2.5 rounded-xl font-semibold hover:bg-gray-200 transition flex items-center gap-2">
                            <i class="fas fa-download"></i>
                            Export Data
                        </button>
                        
                        <button @click="rolloverMonth()" class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-green-200 hover:bg-green-700 transition flex items-center gap-2">
                            <i class="fas fa-forward"></i>
                            Rollover Month
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-8 pt-6">
                <!-- Stats Dashboard -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-1">Total Expected Rent</p>
                                <h3 class="text-2xl font-black text-slate-800">Ksh <span x-text="formatNumber(totalRevenue)"></span></h3>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-money-bill-wave text-blue-600 text-xl"></i>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-3">Monthly expected revenue</p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-1">Total Deposits Held</p>
                                <h3 class="text-2xl font-black text-emerald-600">Ksh <span x-text="formatNumber(totalDeposits)"></span></h3>
                            </div>
                            <div class="w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-shield-alt text-emerald-600 text-xl"></i>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-3">Security deposits held</p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-1">Occupancy Rate</p>
                                <h3 class="text-2xl font-black text-purple-600"><span x-text="occupancyRate"></span>%</h3>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-chart-line text-purple-600 text-xl"></i>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4">
                            <div class="bg-purple-600 h-2.5 rounded-full" :style="{ width: occupancyRate + '%' }"></div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-1">Properties</p>
                                <h3 class="text-2xl font-black text-orange-600"><span x-text="Object.keys(properties).length"></span></h3>
                            </div>
                            <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-building text-orange-600 text-xl"></i>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-3">Total buildings managed</p>
                    </div>
                </div>

                <!-- Properties Overview -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-slate-800">Properties Overview</h3>
                        <div class="flex gap-3">
                            <select x-model="selectedProperty" 
                                    class="bg-gray-50 border border-gray-200 p-2 rounded-lg text-sm font-medium focus:ring-2 focus:ring-blue-500">
                                <option value="">All Properties</option>
                                <template x-for="(property, name) in properties" :key="name">
                                    <option :value="name" x-text="name"></option>
                                </template>
                            </select>
                            <button x-show="userRole === 'owner'" @click="showAddPropertyModal = true"
                                    class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition flex items-center gap-2">
                                <i class="fas fa-plus"></i>
                                Add Property
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <template x-for="(property, name) in filteredProperties" :key="name">
                            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden property-card transition-all">
                                <div class="p-6">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <h4 class="font-bold text-slate-800 text-lg" x-text="name"></h4>
                                            <p class="text-sm text-gray-500" x-text="property.length + ' units'"></p>
                                        </div>
                                        <div class="flex gap-2">
                                            <button @click="viewProperty(name)" class="text-blue-600 hover:text-blue-800 p-1">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button x-show="userRole === 'owner'" @click="editProperty(name)" class="text-amber-600 hover:text-amber-800 p-1">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button x-show="userRole === 'owner'" @click="deleteProperty(name)" class="text-red-600 hover:text-red-800 p-1">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="space-y-3">
                                        <div>
                                            <p class="text-xs text-gray-400 font-medium uppercase">Total Rent</p>
                                            <p class="font-bold text-lg text-slate-800">Ksh <span x-text="formatNumber(calculatePropertyTotal(name, 'rent'))"></span></p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-400 font-medium uppercase">Occupancy</p>
                                            <div class="flex items-center gap-2">
                                                <div class="w-full bg-gray-200 rounded-full h-2">
                                                    <div class="bg-green-500 h-2 rounded-full" 
                                                         :style="{ width: calculateOccupancyRate(name) + '%' }"></div>
                                                </div>
                                                <span class="text-sm font-medium" x-text="calculateOccupancyRate(name) + '%'"></span>
                                            </div>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-400 font-medium uppercase">Vacant Units</p>
                                            <p class="font-medium text-red-600" x-text="countVacantUnits(name)"></p>
                                        </div>
                                    </div>
                                    
                                    <button @click="viewProperty(name)" 
                                            class="w-full mt-6 bg-blue-50 text-blue-600 hover:bg-blue-100 py-2 rounded-lg font-medium transition">
                                        View Details
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-xl font-bold text-slate-800 mb-6">Recent Activity</h3>
                    <div class="overflow-x-auto scrollbar-thin">
                        <table class="w-full min-w-[800px]">
                            <thead>
                                <tr class="text-xs text-gray-400 uppercase tracking-widest border-b border-gray-100">
                                    <th class="pb-3 font-bold text-left">Property</th>
                                    <th class="pb-3 font-bold text-left">Unit</th>
                                    <th class="pb-3 font-bold text-left">Tenant</th>
                                    <th class="pb-3 font-bold text-left">Activity</th>
                                    <th class="pb-3 font-bold text-left">Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="activity in recentActivity" :key="activity.id">
                                    <tr class="border-b border-gray-50 hover:bg-gray-50">
                                        <td class="py-3" x-text="activity.property"></td>
                                        <td class="py-3 font-medium" x-text="activity.unit"></td>
                                        <td class="py-3" x-text="activity.tenant"></td>
                                        <td class="py-3">
                                            <span :class="getActivityClass(activity.type)" 
                                                  class="px-2 py-1 rounded text-xs font-medium" 
                                                  x-text="activity.type"></span>
                                        </td>
                                        <td class="py-3 text-sm text-gray-500" x-text="activity.date"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tenants Management Tab -->
        <div x-show="activeTab === 'tenants'" x-cloak>
            <div class="sticky-header p-8 pb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800">Tenant Management</h2>
                        <p class="text-gray-500 font-medium">Manage all tenants across properties</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button x-show="userRole === 'owner'" @click="showAddTenantModal = true"
                                class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition flex items-center gap-2">
                            <i class="fas fa-plus"></i>
                            Add New Tenant
                        </button>
                        <button @click="printReport()" class="bg-gray-100 text-gray-700 px-5 py-2.5 rounded-xl font-semibold hover:bg-gray-200 transition flex items-center gap-2">
                            <i class="fas fa-print"></i>
                            Print Report
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-8 pt-6">
                <!-- Filter Controls -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Property</label>
                            <select x-model="selectedProperty" @change="filterTenants()"
                                    class="w-full bg-gray-50 border border-gray-200 p-2 rounded-lg text-sm font-medium focus:ring-2 focus:ring-blue-500">
                                <option value="">All Properties</option>
                                <template x-for="(property, name) in properties" :key="name">
                                    <option :value="name" x-text="name"></option>
                                </template>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Status</label>
                            <select x-model="tenantStatusFilter" @change="filterTenants()"
                                    class="w-full bg-gray-50 border border-gray-200 p-2 rounded-lg text-sm font-medium focus:ring-2 focus:ring-blue-500">
                                <option value="">All Status</option>
                                <option value="occupied">Occupied</option>
                                <option value="vacant">Vacant</option>
                                <option value="landlord">Landlord</option>
                                <option value="staff">Staff</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Search</label>
                            <div class="relative">
                                <input type="text" x-model="tenantSearchQuery" @input="filterTenants()" 
                                       placeholder="Search tenants..." 
                                       class="w-full bg-gray-50 border border-gray-200 p-2 pl-9 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                        
                        <div class="flex items-end">
                            <button @click="resetTenantFilters()" 
                                    class="w-full bg-gray-100 text-gray-600 hover:bg-gray-200 px-4 py-2 rounded-lg font-medium transition">
                                Clear Filters
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tenants Table -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="overflow-x-auto scrollbar-thin">
                        <table class="w-full min-w-[1200px]">
                            <thead class="bg-gray-50">
                                <tr class="text-xs text-gray-400 uppercase tracking-widest border-b border-gray-100">
                                    <th class="px-6 py-4 font-bold text-left">Property</th>
                                    <th class="px-6 py-4 font-bold text-left">Unit</th>
                                    <th class="px-6 py-4 font-bold text-left">Tenant Name</th>
                                    <th class="px-6 py-4 font-bold text-left">Phone</th>
                                    <th class="px-6 py-4 font-bold text-left">Rent (Ksh)</th>
                                    <th class="px-6 py-4 font-bold text-left">Deposit</th>
                                    <th class="px-6 py-4 font-bold text-left">Status</th>
                                    <th class="px-6 py-4 font-bold text-left">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="tenant in filteredTenants" :key="tenant.id">
                                    <tr class="border-b border-gray-50 hover:bg-gray-50 transition">
                                        <td class="px-6 py-4" x-text="tenant.property"></td>
                                        <td class="px-6 py-4 font-medium" x-text="tenant.unit"></td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-2">
                                                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                                    <i class="fas fa-user text-blue-600 text-sm"></i>
                                                </div>
                                                <span x-text="tenant.name"></span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4" x-text="tenant.phone || '-'"></td>
                                        <td class="px-6 py-4 font-bold" x-text="formatNumber(tenant.rent)"></td>
                                        <td class="px-6 py-4 font-medium text-emerald-600" x-text="formatNumber(tenant.deposit)"></td>
                                        <td class="px-6 py-4">
                                            <span :class="getStatusClass(tenant.status)" 
                                                  class="px-2 py-1 rounded text-xs font-medium">
                                                <span x-text="getStatusText(tenant.status)"></span>
                                            </span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex gap-2">
                                                <button @click="editTenant(tenant)" 
                                                        class="text-blue-600 hover:text-blue-800 p-1" title="Edit">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button @click="viewTenantDetails(tenant)" 
                                                        class="text-green-600 hover:text-green-800 p-1" title="View">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button x-show="userRole === 'owner'" @click="deleteTenant(tenant)" 
                                                        class="text-red-600 hover:text-red-800 p-1" title="Delete">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                                
                                <template x-if="filteredTenants.length === 0">
                                    <tr>
                                        <td colspan="8" class="px-6 py-12 text-center">
                                            <div class="flex flex-col items-center justify-center text-gray-400">
                                                <i class="fas fa-search text-4xl mb-4"></i>
                                                <p class="text-lg font-medium">No tenants found</p>
                                                <p class="text-sm mt-2">Try adjusting your search filters</p>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <div class="px-6 py-4 border-t border-gray-100 bg-gray-50 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Showing <span x-text="filteredTenants.length"></span> of <span x-text="allTenants.length"></span> tenants
                        </div>
                        <div class="flex gap-2">
                            <button @click="tenantPage = Math.max(1, tenantPage - 1)" 
                                    :disabled="tenantPage === 1"
                                    class="px-3 py-1 rounded-lg border border-gray-300 text-gray-600 disabled:opacity-50">
                                Previous
                            </button>
                            <button @click="tenantPage = tenantPage + 1" 
                                    :disabled="tenantPage * tenantsPerPage >= filteredTenants.length"
                                    class="px-3 py-1 rounded-lg border border-gray-300 text-gray-600 disabled:opacity-50">
                                Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Utility Entry Tab -->
        <div x-show="activeTab === 'utility'" x-cloak>
            <div class="sticky-header p-8 pb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800">Utility Entry System</h2>
                        <p class="text-gray-500 font-medium">Monthly utility readings â€¢ <span class="text-blue-600 font-bold" x-text="currentMonth"></span></p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button @click="saveUtilityReadings()" 
                                class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition flex items-center gap-2">
                            <i class="fas fa-save"></i>
                            Save All Readings
                        </button>
                        <button @click="exportUtilityData()" 
                                class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition flex items-center gap-2">
                            <i class="fas fa-download"></i>
                            Export Data
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-8 pt-6">
                <!-- Utility Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2">Water Readings</p>
                        <h3 class="text-2xl font-black text-blue-600" x-text="pendingWaterReadings"></h3>
                        <p class="text-sm text-gray-500 mt-1">Pending readings</p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2">Electricity</p>
                        <h3 class="text-2xl font-black text-amber-600" x-text="pendingElectricityReadings"></h3>
                        <p class="text-sm text-gray-500 mt-1">Pending readings</p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2">Completion Rate</p>
                        <h3 class="text-2xl font-black text-purple-600" x-text="utilityCompletionRate + '%'"></h3>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div class="bg-purple-600 h-2 rounded-full" :style="{ width: utilityCompletionRate + '%' }"></div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2">Total Utility Bill</p>
                        <h3 class="text-2xl font-black text-emerald-600">Ksh <span x-text="formatNumber(totalUtilityBill)"></span></h3>
                        <p class="text-sm text-gray-500 mt-1">Current month</p>
                    </div>
                </div>

                <!-- Utility Entry Controls -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Property</label>
                            <select x-model="selectedProperty" @change="loadUtilityData()"
                                    class="w-full bg-gray-50 border border-gray-200 p-2 rounded-lg text-sm font-medium focus:ring-2 focus:ring-blue-500">
                                <option value="">Select Property</option>
                                <template x-for="(property, name) in properties" :key="name">
                                    <option :value="name" x-text="name"></option>
                                </template>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Billing Month</label>
                            <input type="month" x-model="utilityMonth" @change="loadUtilityData()"
                                   class="w-full bg-gray-50 border border-gray-200 p-2 rounded-lg text-sm font-medium focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="flex items-end gap-2">
                            <button @click="autoFillZeroReadings()" 
                                    class="flex-1 bg-blue-50 text-blue-600 hover:bg-blue-100 px-4 py-2 rounded-lg font-medium transition">
                                Auto-fill Zeros
                            </button>
                            <button @click="clearUtilityReadings()" 
                                    class="flex-1 bg-red-50 text-red-600 hover:bg-red-100 px-4 py-2 rounded-lg font-medium transition">
                                Clear All
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Utility Table -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="overflow-x-auto scrollbar-thin">
                        <table class="w-full min-w-[1000px]">
                            <thead class="bg-gray-50">
                                <tr class="text-xs text-gray-400 uppercase tracking-widest border-b border-gray-100">
                                    <th class="px-6 py-4 font-bold text-left">Unit</th>
                                    <th class="px-6 py-4 font-bold text-left">Tenant</th>
                                    <th class="px-6 py-4 font-bold text-left text-blue-600">Water (mÂ³)</th>
                                    <th class="px-6 py-4 font-bold text-left text-amber-600">Electricity</th>
                                    <th class="px-6 py-4 font-bold text-left text-emerald-600">Garbage</th>
                                    <th class="px-6 py-4 font-bold text-left">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="unit in utilityUnits" :key="unit.id">
                                    <tr class="border-b border-gray-50 hover:bg-gray-50">
                                        <td class="px-6 py-4 font-medium" x-text="unit.unit"></td>
                                        <td class="px-6 py-4" x-text="unit.tenant"></td>
                                        
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-2">
                                                <input type="number" x-model="unit.water" 
                                                       class="w-24 bg-blue-50 border border-blue-100 rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500"
                                                       step="0.01" placeholder="0.00">
                                                <span class="text-xs text-blue-400">mÂ³</span>
                                            </div>
                                        </td>
                                        
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-2">
                                                <input type="number" x-model="unit.electricity" 
                                                       class="w-24 bg-amber-50 border border-amber-100 rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-amber-500"
                                                       placeholder="0">
                                                <span class="text-xs text-amber-400">kWh</span>
                                            </div>
                                        </td>
                                        
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-2">
                                                <input type="number" x-model="unit.garbage" 
                                                       class="w-24 bg-emerald-50 border border-emerald-100 rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-emerald-500"
                                                       value="200">
                                                <span class="text-xs text-emerald-400">Ksh</span>
                                            </div>
                                        </td>
                                        
                                        <td class="px-6 py-4">
                                            <span :class="getUtilityStatusClass(unit)" 
                                                  class="px-2 py-1 rounded text-xs font-medium" 
                                                  x-text="getUtilityStatusText(unit)"></span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payments Tab -->
        <div x-show="activeTab === 'payments'" x-cloak>
            <div class="sticky-header p-8 pb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800">Payment Management</h2>
                        <p class="text-gray-500 font-medium">Track and manage all payments</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button x-show="userRole === 'owner'" @click="showAddPaymentModal = true"
                                class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition flex items-center gap-2">
                            <i class="fas fa-plus"></i>
                            Record Payment
                        </button>
                        <button @click="exportPayments()" 
                                class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition flex items-center gap-2">
                            <i class="fas fa-download"></i>
                            Export Payments
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-8 pt-6">
                <!-- Payment Summary -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2">Total Collected</p>
                        <h3 class="text-2xl font-black text-emerald-600">Ksh <span x-text="formatNumber(totalCollected)"></span></h3>
                        <p class="text-sm text-gray-500 mt-1">This month</p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2">Pending Payments</p>
                        <h3 class="text-2xl font-black text-amber-600">Ksh <span x-text="formatNumber(totalPending)"></span></h3>
                        <p class="text-sm text-gray-500 mt-1">Outstanding</p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2">Collection Rate</p>
                        <h3 class="text-2xl font-black text-blue-600" x-text="collectionRate + '%'"></h3>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div class="bg-blue-600 h-2 rounded-full" :style="{ width: collectionRate + '%' }"></div>
                        </div>
                    </div>
                </div>

                <!-- Payments Table -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="overflow-x-auto scrollbar-thin">
                        <table class="w-full min-w-[1000px]">
                            <thead class="bg-gray-50">
                                <tr class="text-xs text-gray-400 uppercase tracking-widest border-b border-gray-100">
                                    <th class="px-6 py-4 font-bold text-left">Date</th>
                                    <th class="px-6 py-4 font-bold text-left">Property</th>
                                    <th class="px-6 py-4 font-bold text-left">Unit</th>
                                    <th class="px-6 py-4 font-bold text-left">Tenant</th>
                                    <th class="px-6 py-4 font-bold text-left">Amount</th>
                                    <th class="px-6 py-4 font-bold text-left">Method</th>
                                    <th class="px-6 py-4 font-bold text-left">Status</th>
                                    <th class="px-6 py-4 font-bold text-left">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="payment in payments" :key="payment.id">
                                    <tr class="border-b border-gray-50 hover:bg-gray-50">
                                        <td class="px-6 py-4" x-text="payment.date"></td>
                                        <td class="px-6 py-4" x-text="payment.property"></td>
                                        <td class="px-6 py-4 font-medium" x-text="payment.unit"></td>
                                        <td class="px-6 py-4" x-text="payment.tenant"></td>
                                        <td class="px-6 py-4 font-bold" x-text="'Ksh ' + formatNumber(payment.amount)"></td>
                                        <td class="px-6 py-4">
                                            <span :class="getPaymentMethodClass(payment.method)" 
                                                  class="px-2 py-1 rounded text-xs font-medium" 
                                                  x-text="payment.method"></span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span :class="getPaymentStatusClass(payment.status)" 
                                                  class="px-2 py-1 rounded text-xs font-medium" 
                                                  x-text="payment.status"></span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex gap-2">
                                                <button @click="viewPayment(payment)" 
                                                        class="text-blue-600 hover:text-blue-800 p-1">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button x-show="userRole === 'owner' && payment.status === 'pending'" 
                                                        @click="markPaymentAsPaid(payment)"
                                                        class="text-green-600 hover:text-green-800 p-1">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div x-show="activeTab === 'reports'" x-cloak>
            <div class="sticky-header p-8 pb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800">Financial Reports</h2>
                        <p class="text-gray-500 font-medium">Detailed financial analysis and reports</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button @click="generateMonthlyReport()" 
                                class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition flex items-center gap-2">
                            <i class="fas fa-file-alt"></i>
                            Generate Report
                        </button>
                        <button @click="printFinancialReport()" 
                                class="bg-gray-100 text-gray-700 px-5 py-2.5 rounded-xl font-semibold hover:bg-gray-200 transition flex items-center gap-2">
                            <i class="fas fa-print"></i>
                            Print Report
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-8 pt-6">
                <!-- Report Filters -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 mb-8">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Report Type</label>
                            <select x-model="reportType" class="w-full bg-gray-50 border border-gray-200 p-2 rounded-lg text-sm font-medium">
                                <option value="monthly">Monthly Summary</option>
                                <option value="property">Property Performance</option>
                                <option value="tenant">Tenant Statement</option>
                                <option value="arrears">Arrears Report</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Start Date</label>
                            <input type="month" x-model="reportStartDate" 
                                   class="w-full bg-gray-50 border border-gray-200 p-2 rounded-lg text-sm font-medium">
                        </div>
                        
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">End Date</label>
                            <input type="month" x-model="reportEndDate" 
                                   class="w-full bg-gray-50 border border-gray-200 p-2 rounded-lg text-sm font-medium">
                        </div>
                        
                        <div class="flex items-end">
                            <button @click="generateReport()" 
                                    class="w-full bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition">
                                Generate
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Report Results -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Summary Stats -->
                    <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-xl font-bold text-slate-800 mb-6">Financial Summary</h3>
                        <div class="space-y-6">
                            <div>
                                <p class="text-sm text-gray-500 mb-2">Total Revenue</p>
                                <h4 class="text-2xl font-black text-slate-800">Ksh <span x-text="formatNumber(reportData.totalRevenue || 0)"></span></h4>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-500 mb-2">Rent Collected</p>
                                    <h4 class="text-xl font-bold text-emerald-600">Ksh <span x-text="formatNumber(reportData.rentCollected || 0)"></span></h4>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500 mb-2">Utilities Collected</p>
                                    <h4 class="text-xl font-bold text-blue-600">Ksh <span x-text="formatNumber(reportData.utilitiesCollected || 0)"></span></h4>
                                </div>
                            </div>
                            
                            <div>
                                <p class="text-sm text-gray-500 mb-2">Outstanding Arrears</p>
                                <h4 class="text-xl font-bold text-red-600">Ksh <span x-text="formatNumber(reportData.outstandingArrears || 0)"></span></h4>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Property Performance -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-xl font-bold text-slate-800 mb-6">Top Properties</h3>
                        <div class="space-y-4">
                            <template x-for="property in topProperties" :key="property.name">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="font-medium text-slate-800" x-text="property.name"></p>
                                        <p class="text-sm text-gray-500" x-text="property.occupancy + '% occupancy'"></p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-bold text-slate-800">Ksh <span x-text="formatNumber(property.revenue)"></span></p>
                                        <p class="text-xs" :class="property.collectionRate >= 90 ? 'text-emerald-600' : 'text-amber-600'">
                                            <span x-text="property.collectionRate + '%'"></span> collected
                                        </p>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Landlord Statement Tab -->
        <div x-show="activeTab === 'statement'" x-cloak>
            <div class="sticky-header p-8 pb-6 no-print">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800">Landlord Statement</h2>
                        <p class="text-gray-500 font-medium">Monthly settlement report for landlords</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button @click="printStatement()" 
                                class="bg-slate-900 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-slate-800 transition flex items-center gap-2">
                            <i class="fas fa-print"></i>
                            Print Statement
                        </button>
                        <button @click="generateStatement()" 
                                class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition flex items-center gap-2">
                            <i class="fas fa-file-alt"></i>
                            Generate Statement
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-8 pt-6">
                <!-- Landlord Statement Content -->
                <div class="max-w-5xl mx-auto bg-white p-8 shadow-2xl rounded-sm border border-slate-200" id="printable-area">
                    <div class="flex justify-between items-start border-b-4 border-slate-900 pb-6 mb-8">
                        <div>
                            <h1 class="text-4xl font-black tracking-tighter text-slate-900">LANDLORD STATEMENT</h1>
                            <p class="text-slate-500 font-bold uppercase tracking-widest text-xs mt-1">Eagle Homes Property Management</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-slate-800">Date: <span x-text="currentMonth"></span></p>
                            <p class="text-sm text-slate-500">Property: <span x-text="selectedProperty || 'All Properties'"></span></p>
                        </div>
                    </div>

                    <!-- Property Selection -->
                    <div class="mb-8 no-print">
                        <label class="block text-sm font-medium text-slate-700 mb-2">Select Property for Statement</label>
                        <select x-model="selectedProperty" @change="loadStatementData()"
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                            <option value="">All Properties</option>
                            <template x-for="(property, name) in properties" :key="name">
                                <option :value="name" x-text="name"></option>
                            </template>
                        </select>
                    </div>

                    <!-- Statement Table -->
                    <div class="overflow-x-auto mb-8">
                        <table class="w-full text-xs border-collapse">
                            <thead>
                                <tr class="bg-slate-900 text-white uppercase tracking-tighter">
                                    <th class="p-2 border border-slate-900">Unit</th>
                                    <th class="p-2 border border-slate-900">Tenant</th>
                                    <th class="p-2 border border-slate-900 text-right">Rent</th>
                                    <th class="p-2 border border-slate-900 text-right">Paid</th>
                                    <th class="p-2 border border-slate-900">Date</th>
                                    <th class="p-2 border border-slate-900 text-right">Deposit</th>
                                    <th class="p-2 border border-slate-900 text-right">Garbage</th>
                                    <th class="p-2 border border-slate-900 text-right">Balance</th>
                                    <th class="p-2 border border-slate-900">Remarks</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="tenant in statementTenants" :key="tenant.id">
                                    <tr>
                                        <td class="p-2 border border-slate-200 font-bold" x-text="tenant.unit"></td>
                                        <td class="p-2 border border-slate-200" x-text="tenant.name"></td>
                                        <td class="p-2 border border-slate-200 text-right" x-text="formatNumber(tenant.rent)"></td>
                                        <td class="p-2 border border-slate-200 text-right font-bold text-blue-700" 
                                            x-text="formatNumber(tenant.paid)"></td>
                                        <td class="p-2 border border-slate-200 text-[10px]" x-text="tenant.paymentDate || '-'"></td>
                                        <td class="p-2 border border-slate-200 text-right" x-text="formatNumber(tenant.deposit)"></td>
                                        <td class="p-2 border border-slate-200 text-right">200</td>
                                        <td class="p-2 border border-slate-200 text-right font-bold" 
                                            :class="tenant.balance > 0 ? 'text-red-500' : 'text-emerald-600'"
                                            x-text="formatNumber(tenant.balance)"></td>
                                        <td class="p-2 border border-slate-200 italic text-[10px]" x-text="tenant.status"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>

                    <!-- Financial Summary -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                        <!-- Expenses Section -->
                        <div>
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-black text-slate-800 uppercase text-sm">Expenses (Manual Entry)</h3>
                                <button @click="addExpense()" class="no-print bg-slate-100 px-3 py-1 rounded text-xs font-bold hover:bg-slate-200 transition">
                                    + ADD EXPENSE
                                </button>
                            </div>
                            <div class="space-y-1 text-sm">
                                <template x-for="(expense, index) in expenses" :key="index">
                                    <div class="flex justify-between border-b border-dotted py-2">
                                        <span x-text="expense.description"></span>
                                        <span class="font-mono text-red-600" x-text="'Ksh ' + formatNumber(expense.amount)"></span>
                                    </div>
                                </template>
                                <div class="flex justify-between font-bold pt-2 border-t-2 border-slate-200">
                                    <span>TOTAL EXPENSES</span>
                                    <span class="text-red-600">Ksh <span x-text="formatNumber(totalExpenses)"></span></span>
                                </div>
                            </div>
                        </div>

                        <!-- Commission & Net Summary -->
                        <div class="bg-slate-50 p-6 rounded-lg border border-slate-200">
                            <h3 class="font-black text-slate-800 uppercase text-sm mb-4">Commission & Settlement</h3>
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-slate-500">Gross Collected</span>
                                    <span class="font-bold">Ksh <span x-text="formatNumber(totalCollected)"></span></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-500">Management Commission (<span x-text="(commissionRate * 100)"></span>%)</span>
                                    <span class="font-bold text-red-500">- Ksh <span x-text="formatNumber(commission)"></span></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-500">Operating Expenses</span>
                                    <span class="font-bold text-red-500">- Ksh <span x-text="formatNumber(totalExpenses)"></span></span>
                                </div>
                                <div class="flex justify-between pt-4 border-t-4 border-double border-slate-400">
                                    <span class="font-black text-slate-900 uppercase">Net Balance to Landlord</span>
                                    <span class="font-black text-2xl text-emerald-700">Ksh <span x-text="formatNumber(netToLandlord)"></span></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Print Button -->
                    <div class="mt-12 flex gap-4 no-print">
                        <button @click="printStatement()" 
                                class="flex-1 bg-slate-900 text-white py-4 rounded-xl font-black text-sm uppercase tracking-widest hover:bg-slate-800 transition">
                            Download PDF Statement
                        </button>
                        <button @click="saveStatement()" 
                                class="flex-1 bg-blue-600 text-white py-4 rounded-xl font-black text-sm uppercase tracking-widest hover:bg-blue-700 transition">
                            Save Statement
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Properties Management Tab -->
        <div x-show="activeTab === 'properties'" x-cloak>
            <div class="sticky-header p-8 pb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800">Properties Management</h2>
                        <p class="text-gray-500 font-medium">Manage all properties and buildings</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button x-show="userRole === 'owner'" @click="showAddPropertyModal = true"
                                class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition flex items-center gap-2">
                            <i class="fas fa-plus"></i>
                            Add New Property
                        </button>
                        <button @click="exportPropertiesData()" 
                                class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition flex items-center gap-2">
                            <i class="fas fa-download"></i>
                            Export Data
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-8 pt-6">
                <!-- Properties Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <template x-for="(property, name) in properties" :key="name">
                        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden property-card">
                            <div class="p-6">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <h4 class="font-bold text-slate-800 text-lg" x-text="name"></h4>
                                        <p class="text-sm text-gray-500" x-text="property.length + ' units'"></p>
                                    </div>
                                    <div class="flex gap-2">
                                        <button @click="viewProperty(name)" class="text-blue-600 hover:text-blue-800 p-1">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button x-show="userRole === 'owner'" @click="editProperty(name)" class="text-amber-600 hover:text-amber-800 p-1">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button x-show="userRole === 'owner'" @click="deleteProperty(name)" class="text-red-600 hover:text-red-800 p-1">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="space-y-3">
                                    <div>
                                        <p class="text-xs text-gray-400 font-medium uppercase">Total Rent</p>
                                        <p class="font-bold text-lg text-slate-800">Ksh <span x-text="formatNumber(calculatePropertyTotal(name, 'rent'))"></span></p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-400 font-medium uppercase">Occupancy</p>
                                        <div class="flex items-center gap-2">
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div class="bg-green-500 h-2 rounded-full" 
                                                     :style="{ width: calculateOccupancyRate(name) + '%' }"></div>
                                            </div>
                                            <span class="text-sm font-medium" x-text="calculateOccupancyRate(name) + '%'"></span>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-400 font-medium uppercase">Vacant Units</p>
                                        <p class="font-medium text-red-600" x-text="countVacantUnits(name)"></p>
                                    </div>
                                </div>
                                
                                <button @click="viewProperty(name)" 
                                        class="w-full mt-6 bg-blue-50 text-blue-600 hover:bg-blue-100 py-2 rounded-lg font-medium transition">
                                    Manage Units
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div x-show="activeTab === 'settings'" x-cloak>
            <div class="sticky-header p-8 pb-6">
                <h2 class="text-3xl font-black text-slate-800">System Settings</h2>
                <p class="text-gray-500 font-medium">Configure system preferences and settings</p>
            </div>

            <div class="p-8 pt-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- General Settings -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-xl font-bold text-slate-800 mb-6">General Settings</h3>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Company Name</label>
                                <input type="text" x-model="settings.companyName" 
                                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Default Water Rate (per mÂ³)</label>
                                <input type="number" x-model="settings.waterRate" 
                                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Default Electricity Rate (per kWh)</label>
                                <input type="number" x-model="settings.electricityRate" 
                                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Default Garbage Fee</label>
                                <input type="number" x-model="settings.garbageFee" 
                                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Commission Rate (%)</label>
                                <input type="number" x-model="commissionRate" step="0.01"
                                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <button @click="saveSettings()" 
                                    class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">
                                Save Settings
                            </button>
                        </div>
                    </div>
                    
                    <!-- System Actions -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-xl font-bold text-slate-800 mb-6">System Actions</h3>
                        <div class="space-y-4">
                            <button @click="backupData()" 
                                    class="w-full bg-emerald-50 text-emerald-700 hover:bg-emerald-100 py-3 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i class="fas fa-database"></i>
                                Backup All Data
                            </button>
                            
                            <button @click="restoreData()" 
                                    class="w-full bg-amber-50 text-amber-700 hover:bg-amber-100 py-3 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i class="fas fa-history"></i>
                                Restore from Backup
                            </button>
                            
                            <button @click="clearAllData()" 
                                    class="w-full bg-red-50 text-red-700 hover:bg-red-100 py-3 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i class="fas fa-trash"></i>
                                Clear All Data
                            </button>
                            
                            <button @click="rolloverMonth()" 
                                    class="w-full bg-purple-600 text-white hover:bg-purple-700 py-3 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i class="fas fa-forward"></i>
                                Rollover to Next Month
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- Add/Edit Property Modal -->
    <div x-show="showAddPropertyModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-100">
                <h3 class="text-xl font-bold text-slate-800" x-text="editingProperty ? 'Edit Property' : 'Add New Property'"></h3>
            </div>
            
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Property Name</label>
                        <input type="text" x-model="newProperty.name" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Address</label>
                        <input type="text" x-model="newProperty.address" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Number of Units</label>
                        <input type="number" x-model="newProperty.units" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Property Manager</label>
                        <input type="text" x-model="newProperty.manager" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Notes</label>
                        <textarea x-model="newProperty.notes" rows="3"
                                  class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                </div>
                
                <div class="flex gap-3 mt-8">
                    <button @click="saveProperty()" 
                            class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">
                        Save Property
                    </button>
                    <button @click="showAddPropertyModal = false" 
                            class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-200 transition">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Tenant Modal -->
    <div x-show="showAddTenantModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-100">
                <h3 class="text-xl font-bold text-slate-800" x-text="editingTenant ? 'Edit Tenant' : 'Add New Tenant'"></h3>
            </div>
            
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Property</label>
                        <select x-model="newTenant.property" 
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                            <option value="">Select Property</option>
                            <template x-for="(property, name) in properties" :key="name">
                                <option :value="name" x-text="name"></option>
                            </template>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Unit Number</label>
                        <input type="text" x-model="newTenant.unit" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-slate-700 mb-2">Tenant Name</label>
                        <input type="text" x-model="newTenant.name" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Phone Number</label>
                        <input type="tel" x-model="newTenant.phone" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Email</label>
                        <input type="email" x-model="newTenant.email" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Rent Amount (Ksh)</label>
                        <input type="number" x-model="newTenant.rent" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Deposit (Ksh)</label>
                        <input type="number" x-model="newTenant.deposit" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Entry Date</label>
                        <input type="date" x-model="newTenant.entryDate" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Status</label>
                        <select x-model="newTenant.status" 
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                            <option value="occupied">Occupied</option>
                            <option value="vacant">Vacant</option>
                            <option value="landlord">Landlord Unit</option>
                            <option value="staff">Staff Unit</option>
                        </select>
                    </div>
                </div>
                
                <div class="mt-6">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Notes</label>
                    <textarea x-model="newTenant.notes" rows="3"
                              class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                
                <div class="flex gap-3 mt-8">
                    <button @click="saveTenant()" 
                            class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">
                        Save Tenant
                    </button>
                    <button @click="showAddTenantModal = false" 
                            class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-200 transition">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal (Login Page would have this, included here for reference) -->
    <div x-show="showResetModal" x-cloak class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-md rounded-3xl p-8 shadow-2xl" @click.away="showResetModal = false">
            <h2 class="text-2xl font-black text-slate-900 mb-2">Reset Password</h2>
            <p class="text-slate-500 text-sm mb-6">Enter your registered email. We will notify <span class="text-blue-600 font-bold">eaglehomesagencies4@gmail.com</span> to authorize your reset.</p>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Your Email Address</label>
                    <input type="email" x-model="resetEmail" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="e.g. secretary@eaglehomes.com">
                </div>
                
                <button @click="sendResetRequest()" 
                        :disabled="isSending"
                        class="w-full bg-slate-900 text-white py-4 rounded-xl font-bold hover:bg-slate-800 transition flex items-center justify-center gap-2">
                    <span x-show="!isSending">Send Reset Request</span>
                    <span x-show="isSending" class="animate-spin text-lg">â—Œ</span>
                </button>
                
                <button @click="showResetModal = false" class="w-full text-slate-400 text-sm font-medium">Back to Login</button>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div x-show="showToast" x-transition
         :class="toastType === 'success' ? 'bg-green-500' : 'bg-red-500'"
         class="fixed bottom-4 right-4 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-3">
        <i :class="toastType === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle'"></i>
        <span x-text="toastMessage"></span>
    </div>

    <script>
        function managementSystem() {
            return {
                // State Management
                activeTab: 'dashboard',
                userRole: 'owner',
                editMode: false,
                
                // Filter States
                selectedProperty: '',
                selectedUnit: '',
                tenantStatusFilter: '',
                tenantSearchQuery: '',
                tenantPage: 1,
                tenantsPerPage: 20,
                
                // Utility States
                utilityMonth: new Date().toISOString().slice(0, 7),
                utilityUnits: [],
                
                // Report States
                reportType: 'monthly',
                reportStartDate: new Date().toISOString().slice(0, 7),
                reportEndDate: new Date().toISOString().slice(0, 7),
                reportData: {},
                
                // Landlord Statement States
                expenses: [],
                commissionRate: 0.10, // 10% Commission
                statementTenants: [],
                
                // Password Reset States
                showResetModal: false,
                resetEmail: '',
                isSending: false,
                
                // Modal States
                showAddPropertyModal: false,
                showAddTenantModal: false,
                showAddPaymentModal: false,
                editingProperty: null,
                editingTenant: null,
                
                // New Item States
                newProperty: {
                    name: '',
                    address: '',
                    units: 0,
                    manager: '',
                    notes: ''
                },
                
                newTenant: {
                    property: '',
                    unit: '',
                    name: '',
                    phone: '',
                    email: '',
                    rent: 0,
                    deposit: 0,
                    entryDate: new Date().toISOString().slice(0, 10),
                    status: 'occupied',
                    notes: ''
                },
                
                // Toast Notification
                showToast: false,
                toastMessage: '',
                toastType: 'success',
                
                // Data Storage
                properties: {},
                tenants: [],
                payments: [],
                settings: {
                    companyName: 'Eagle Homes',
                    waterRate: 100,
                    electricityRate: 20,
                    garbageFee: 200
                },
                
                // Computed Properties
                get currentMonth() {
                    return new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                },
                
                get filteredProperties() {
                    if (!this.selectedProperty) return this.properties;
                    return { [this.selectedProperty]: this.properties[this.selectedProperty] };
                },
                
                get allTenants() {
                    const allTenants = [];
                    Object.entries(this.properties).forEach(([property, units]) => {
                        units.forEach(unit => {
                            allTenants.push({
                                id: `${property}-${unit.unit}`,
                                property: property,
                                unit: unit.unit,
                                name: unit.name,
                                phone: unit.phone,
                                rent: unit.rent,
                                deposit: unit.deposit,
                                status: unit.status,
                                entryDate: unit.entryDate,
                                notes: unit.notes
                            });
                        });
                    });
                    return allTenants;
                },
                
                get filteredTenants() {
                    let filtered = this.allTenants;
                    
                    // Filter by property
                    if (this.selectedProperty) {
                        filtered = filtered.filter(t => t.property === this.selectedProperty);
                    }
                    
                    // Filter by status
                    if (this.tenantStatusFilter) {
                        filtered = filtered.filter(t => t.status === this.tenantStatusFilter);
                    }
                    
                    // Filter by search query
                    if (this.tenantSearchQuery) {
                        const query = this.tenantSearchQuery.toLowerCase();
                        filtered = filtered.filter(t => 
                            t.name.toLowerCase().includes(query) ||
                            t.unit.toLowerCase().includes(query) ||
                            t.property.toLowerCase().includes(query) ||
                            (t.phone && t.phone.toLowerCase().includes(query))
                        );
                    }
                    
                    // Pagination
                    const start = (this.tenantPage - 1) * this.tenantsPerPage;
                    const end = start + this.tenantsPerPage;
                    return filtered.slice(start, end);
                },
                
                get totalRevenue() {
                    return this.allTenants.reduce((sum, tenant) => sum + (tenant.rent || 0), 0);
                },
                
                get totalDeposits() {
                    return this.allTenants.reduce((sum, tenant) => sum + (tenant.deposit || 0), 0);
                },
                
                get occupancyRate() {
                    if (this.allTenants.length === 0) return 0;
                    const occupied = this.allTenants.filter(t => t.status === 'occupied').length;
                    return Math.round((occupied / this.allTenants.length) * 100);
                },
                
                get pendingWaterReadings() {
                    return this.utilityUnits.filter(u => !u.water).length;
                },
                
                get pendingElectricityReadings() {
                    return this.utilityUnits.filter(u => !u.electricity).length;
                },
                
                get utilityCompletionRate() {
                    if (this.utilityUnits.length === 0) return 0;
                    const completed = this.utilityUnits.filter(u => u.water && u.electricity).length;
                    return Math.round((completed / this.utilityUnits.length) * 100);
                },
                
                get totalUtilityBill() {
                    return this.utilityUnits.reduce((sum, unit) => {
                        const waterBill = (unit.water || 0) * this.settings.waterRate;
                        const electricityBill = (unit.electricity || 0) * this.settings.electricityRate;
                        const garbageBill = unit.garbage || this.settings.garbageFee;
                        return sum + waterBill + electricityBill + garbageBill;
                    }, 0);
                },
                
                get totalCollected() {
                    return this.payments.filter(p => p.status === 'paid').reduce((sum, p) => sum + p.amount, 0);
                },
                
                get totalPending() {
                    return this.allTenants.reduce((sum, tenant) => sum + tenant.rent, 0) - this.totalCollected;
                },
                
                get collectionRate() {
                    const totalRent = this.totalRevenue;
                    if (totalRent === 0) return 100;
                    return Math.round((this.totalCollected / totalRent) * 100);
                },
                
                get recentActivity() {
                    const activities = [];
                    
                    // Add tenant activities
                    this.allTenants.slice(0, 5).forEach(tenant => {
                        activities.push({
                            id: `tenant-${tenant.id}`,
                            property: tenant.property,
                            unit: tenant.unit,
                            tenant: tenant.name,
                            type: tenant.status === 'occupied' ? 'Occupied' : 'Vacant',
                            date: tenant.entryDate || 'Recent'
                        });
                    });
                    
                    // Add payment activities
                    this.payments.slice(0, 5).forEach(payment => {
                        activities.push({
                            id: `payment-${payment.id}`,
                            property: payment.property,
                            unit: payment.unit,
                            tenant: payment.tenant,
                            type: `Payment: ${payment.status}`,
                            date: payment.date
                        });
                    });
                    
                    return activities.slice(0, 10);
                },
                
                get topProperties() {
                    const propertyStats = {};
                    
                    Object.entries(this.properties).forEach(([name, units]) => {
                        const occupied = units.filter(u => u.status === 'occupied').length;
                        const total = units.length;
                        const revenue = units.reduce((sum, u) => sum + (u.rent || 0), 0);
                        
                        propertyStats[name] = {
                            name: name,
                            occupancy: total > 0 ? Math.round((occupied / total) * 100) : 0,
                            revenue: revenue,
                            collectionRate: 85 // This would come from actual payment data
                        };
                    });
                    
                    return Object.values(propertyStats)
                        .sort((a, b) => b.revenue - a.revenue)
                        .slice(0, 5);
                },
                
                get totalExpenses() {
                    return this.expenses.reduce((sum, e) => sum + (e.amount || 0), 0);
                },
                
                get commission() {
                    return this.totalCollected * this.commissionRate;
                },
                
                get netToLandlord() {
                    return this.totalCollected - this.totalExpenses - this.commission;
                },
                
                // Initialization
                init() {
                    // Load saved data from localStorage
                    const savedProperties = localStorage.getItem('eagle_properties');
                    const savedPayments = localStorage.getItem('eagle_payments');
                    const savedSettings = localStorage.getItem('eagle_settings');
                    const savedRole = localStorage.getItem('userRole');
                    const savedExpenses = localStorage.getItem('eagle_expenses');
                    const savedCommissionRate = localStorage.getItem('commissionRate');
                    
                    if (savedRole) this.userRole = savedRole;
                    if (savedSettings) this.settings = JSON.parse(savedSettings);
                    if (savedCommissionRate) this.commissionRate = parseFloat(savedCommissionRate);
                    if (savedExpenses) this.expenses = JSON.parse(savedExpenses);
                    
                    if (savedProperties) {
                        this.properties = JSON.parse(savedProperties);
                    } else {
                        // Initialize with sample data
                        this.initializeSampleData();
                    }
                    
                    if (savedPayments) {
                        this.payments = JSON.parse(savedPayments);
                    }
                    
                    // Initialize utility data
                    this.loadUtilityData();
                },
                
                initializeSampleData() {
                    // Sample data structure
                    this.properties = {
                        "ROSALIA HOUSE": [
                            { unit: "1", name: "Paul Murimi", rent: 3000, deposit: 3000, phone: "0712345678", status: "occupied", entryDate: "2025-01-01", notes: "" },
                            { unit: "2", name: "Jane Mwangi", rent: 1500, deposit: 1500, phone: "0723456789", status: "occupied", entryDate: "2025-01-01", notes: "" },
                            { unit: "3", name: "John Kamau", rent: 3000, deposit: 3000, phone: "0734567890", status: "occupied", entryDate: "2025-01-01", notes: "" },
                        ],
                        "JOSPHINE NJAMBI": [
                            { unit: "1", name: "Simon Ndungu", rent: 4150, deposit: 4150, phone: "0745678901", status: "occupied", entryDate: "2025-01-01", notes: "" },
                            { unit: "2", name: "Irene Gichuki", rent: 3650, deposit: 3650, phone: "0756789012", status: "occupied", entryDate: "2025-01-01", notes: "" },
                        ]
                    };
                    
                    // Sample payments
                    this.payments = [
                        { id: 1, property: "ROSALIA HOUSE", unit: "1", tenant: "Paul Murimi", amount: 3000, method: "mpesa", status: "paid", date: "2025-01-05" },
                        { id: 2, property: "ROSALIA HOUSE", unit: "2", tenant: "Jane Mwangi", amount: 1500, method: "cash", status: "paid", date: "2025-01-06" },
                        { id: 3, property: "JOSPHINE NJAMBI", unit: "1", tenant: "Simon Ndungu", amount: 4150, method: "bank", status: "paid", date: "2025-01-07" },
                    ];
                    
                    // Save initial data
                    this.saveData();
                },
                
                // Property Management Functions
                viewProperty(propertyName) {
                    this.selectedProperty = propertyName;
                    this.activeTab = 'tenants';
                },
                
                editProperty(propertyName) {
                    this.editingProperty = propertyName;
                    const property = this.properties[propertyName];
                    this.newProperty = {
                        name: propertyName,
                        address: '',
                        units: property.length,
                        manager: '',
                        notes: ''
                    };
                    this.showAddPropertyModal = true;
                },
                
                deleteProperty(propertyName) {
                    if (confirm(`Are you sure you want to delete ${propertyName}? This will also delete all tenants in this property.`)) {
                        delete this.properties[propertyName];
                        this.saveData();
                        this.showToastMessage('Property deleted successfully', 'success');
                    }
                },
                
                saveProperty() {
                    if (!this.newProperty.name.trim()) {
                        this.showToastMessage('Property name is required', 'error');
                        return;
                    }
                    
                    if (this.editingProperty && this.editingProperty !== this.newProperty.name) {
                        // Rename property
                        this.properties[this.newProperty.name] = this.properties[this.editingProperty];
                        delete this.properties[this.editingProperty];
                    } else if (!this.properties[this.newProperty.name]) {
                        // Create new property with empty units
                        this.properties[this.newProperty.name] = [];
                    }
                    
                    // Add the number of units specified
                    const currentUnits = this.properties[this.newProperty.name].length;
                    const targetUnits = parseInt(this.newProperty.units) || 0;
                    
                    if (targetUnits > currentUnits) {
                        // Add new units
                        for (let i = currentUnits + 1; i <= targetUnits; i++) {
                            this.properties[this.newProperty.name].push({
                                unit: i.toString(),
                                name: "Vacant",
                                rent: 0,
                                deposit: 0,
                                status: "vacant",
                                entryDate: "",
                                notes: ""
                            });
                        }
                    } else if (targetUnits < currentUnits) {
                        // Remove excess units (from the end)
                        this.properties[this.newProperty.name] = this.properties[this.newProperty.name].slice(0, targetUnits);
                    }
                    
                    this.saveData();
                    this.showAddPropertyModal = false;
                    this.editingProperty = null;
                    this.newProperty = { name: '', address: '', units: 0, manager: '', notes: '' };
                    this.showToastMessage('Property saved successfully', 'success');
                },
                
                // Tenant Management Functions
                filterTenants() {
                    this.tenantPage = 1;
                },
                
                resetTenantFilters() {
                    this.selectedProperty = '';
                    this.tenantStatusFilter = '';
                    this.tenantSearchQuery = '';
                    this.tenantPage = 1;
                },
                
                editTenant(tenant) {
                    this.editingTenant = tenant.id;
                    this.newTenant = { ...tenant };
                    this.showAddTenantModal = true;
                },
                
                viewTenantDetails(tenant) {
                    // In a real app, this would show detailed tenant information
                    alert(`Tenant Details:\n\nName: ${tenant.name}\nProperty: ${tenant.property}\nUnit: ${tenant.unit}\nRent: Ksh ${tenant.rent}\nStatus: ${tenant.status}`);
                },
                
                deleteTenant(tenant) {
                    if (confirm(`Are you sure you want to delete ${tenant.name}?`)) {
                        const property = this.properties[tenant.property];
                        if (property) {
                            const index = property.findIndex(u => u.unit === tenant.unit);
                            if (index !== -1) {
                                property.splice(index, 1);
                                this.saveData();
                                this.showToastMessage('Tenant deleted successfully', 'success');
                            }
                        }
                    }
                },
                
                saveTenant() {
                    if (!this.newTenant.property || !this.newTenant.name.trim()) {
                        this.showToastMessage('Property and tenant name are required', 'error');
                        return;
                    }
                    
                    const property = this.properties[this.newTenant.property];
                    if (!property) {
                        this.showToastMessage('Selected property not found', 'error');
                        return;
                    }
                    
                    const existingIndex = property.findIndex(u => u.unit === this.newTenant.unit);
                    
                    if (existingIndex !== -1) {
                        // Update existing tenant
                        property[existingIndex] = {
                            unit: this.newTenant.unit,
                            name: this.newTenant.name,
                            rent: parseFloat(this.newTenant.rent) || 0,
                            deposit: parseFloat(this.newTenant.deposit) || 0,
                            phone: this.newTenant.phone || '',
                            status: this.newTenant.status,
                            entryDate: this.newTenant.entryDate,
                            notes: this.newTenant.notes || ''
                        };
                    } else {
                        // Add new tenant
                        property.push({
                            unit: this.newTenant.unit,
                            name: this.newTenant.name,
                            rent: parseFloat(this.newTenant.rent) || 0,
                            deposit: parseFloat(this.newTenant.deposit) || 0,
                            phone: this.newTenant.phone || '',
                            status: this.newTenant.status,
                            entryDate: this.newTenant.entryDate,
                            notes: this.newTenant.notes || ''
                        });
                    }
                    
                    this.saveData();
                    this.showAddTenantModal = false;
                    this.editingTenant = null;
                    this.newTenant = {
                        property: '',
                        unit: '',
                        name: '',
                        phone: '',
                        email: '',
                        rent: 0,
                        deposit: 0,
                        entryDate: new Date().toISOString().slice(0, 10),
                        status: 'occupied',
                        notes: ''
                    };
                    this.showToastMessage('Tenant saved successfully', 'success');
                },
                
                // Utility Functions
                loadUtilityData() {
                    if (!this.selectedProperty) {
                        this.utilityUnits = [];
                        return;
                    }
                    
                    const property = this.properties[this.selectedProperty];
                    if (!property) return;
                    
                    this.utilityUnits = property.map(unit => ({
                        id: `${this.selectedProperty}-${unit.unit}`,
                        property: this.selectedProperty,
                        unit: unit.unit,
                        tenant: unit.name,
                        water: '',
                        electricity: '',
                        garbage: this.settings.garbageFee
                    }));
                },
                
                autoFillZeroReadings() {
                    this.utilityUnits.forEach(unit => {
                        if (!unit.water) unit.water = 0;
                        if (!unit.electricity) unit.electricity = 0;
                    });
                    this.showToastMessage('Zero readings auto-filled', 'success');
                },
                
                clearUtilityReadings() {
                    if (confirm('Clear all utility readings?')) {
                        this.utilityUnits.forEach(unit => {
                            unit.water = '';
                            unit.electricity = '';
                        });
                        this.showToastMessage('All readings cleared', 'success');
                    }
                },
                
                saveUtilityReadings() {
                    // In a real app, this would save to a separate utility history
                    this.showToastMessage('Utility readings saved successfully', 'success');
                },
                
                // Payment Functions
                markPaymentAsPaid(payment) {
                    payment.status = 'paid';
                    this.saveData();
                    this.showToastMessage('Payment marked as paid', 'success');
                },
                
                // Landlord Statement Functions
                loadStatementData() {
                    if (!this.selectedProperty) {
                        // Load all tenants
                        this.statementTenants = this.allTenants.map(tenant => {
                            const paidAmount = this.payments
                                .filter(p => p.property === tenant.property && p.unit === tenant.unit && p.status === 'paid')
                                .reduce((sum, p) => sum + p.amount, 0);
                            
                            const latestPayment = this.payments
                                .filter(p => p.property === tenant.property && p.unit === tenant.unit)
                                .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                            
                            return {
                                ...tenant,
                                paid: paidAmount,
                                balance: tenant.rent - paidAmount,
                                paymentDate: latestPayment ? latestPayment.date : null,
                                status: paidAmount >= tenant.rent ? 'Paid' : 'Pending'
                            };
                        });
                    } else {
                        // Load tenants for selected property only
                        const propertyTenants = this.allTenants.filter(t => t.property === this.selectedProperty);
                        this.statementTenants = propertyTenants.map(tenant => {
                            const paidAmount = this.payments
                                .filter(p => p.property === tenant.property && p.unit === tenant.unit && p.status === 'paid')
                                .reduce((sum, p) => sum + p.amount, 0);
                            
                            const latestPayment = this.payments
                                .filter(p => p.property === tenant.property && p.unit === tenant.unit)
                                .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                            
                            return {
                                ...tenant,
                                paid: paidAmount,
                                balance: tenant.rent - paidAmount,
                                paymentDate: latestPayment ? latestPayment.date : null,
                                status: paidAmount >= tenant.rent ? 'Paid' : 'Pending'
                            };
                        });
                    }
                },
                
                generateStatement() {
                    this.loadStatementData();
                    this.showToastMessage('Landlord statement generated', 'success');
                },
                
                addExpense() {
                    const description = prompt("Expense Description:");
                    const amount = prompt("Amount (Ksh):");
                    if (description && amount && !isNaN(amount)) {
                        this.expenses.push({
                            description: description,
                            amount: parseFloat(amount)
                        });
                        localStorage.setItem('eagle_expenses', JSON.stringify(this.expenses));
                        this.showToastMessage('Expense added', 'success');
                    } else if (amount && isNaN(amount)) {
                        this.showToastMessage('Please enter a valid amount', 'error');
                    }
                },
                
                printStatement() {
                    window.print();
                },
                
                saveStatement() {
                    const statementData = {
                        month: this.currentMonth,
                        property: this.selectedProperty,
                        tenants: this.statementTenants,
                        expenses: this.expenses,
                        summary: {
                            totalCollected: this.totalCollected,
                            totalExpenses: this.totalExpenses,
                            commission: this.commission,
                            netToLandlord: this.netToLandlord
                        },
                        timestamp: new Date().toISOString()
                    };
                    
                    const dataStr = JSON.stringify(statementData, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `landlord-statement-${this.currentMonth}-${this.selectedProperty || 'all'}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    this.showToastMessage('Statement saved', 'success');
                },
                
                // Report Functions
                generateReport() {
                    // Generate report based on selected filters
                    this.reportData = {
                        totalRevenue: this.totalRevenue,
                        rentCollected: this.totalCollected,
                        utilitiesCollected: 0, // This would come from actual utility payment data
                        outstandingArrears: this.totalPending
                    };
                    
                    this.showToastMessage('Report generated successfully', 'success');
                },
                
                // System Functions
                toggleEditMode() {
                    if (this.userRole !== 'owner') {
                        this.showToastMessage('Only owners can edit data', 'error');
                        return;
                    }
                    
                    this.editMode = !this.editMode;
                    if (this.editMode) {
                        this.showToastMessage('Edit mode activated', 'success');
                    } else {
                        this.saveAllChanges();
                    }
                },
                
                saveAllChanges() {
                    this.saveData();
                    this.editMode = false;
                    this.showToastMessage('All changes saved successfully', 'success');
                },
                
                rolloverMonth() {
                    if (confirm('Rollover to next month? This will reset monthly data for the new period.')) {
                        // Reset monthly data
                        this.utilityUnits.forEach(unit => {
                            unit.water = '';
                            unit.electricity = '';
                        });
                        
                        // Reset payment status for new month (in a real app)
                        this.showToastMessage('Month rolled over successfully', 'success');
                    }
                },
                
                saveSettings() {
                    localStorage.setItem('eagle_settings', JSON.stringify(this.settings));
                    localStorage.setItem('commissionRate', this.commissionRate.toString());
                    this.showToastMessage('Settings saved successfully', 'success');
                },
                
                updateSecretaryPassword() {
                    const newPassword = document.getElementById('sec_pass').value;
                    if (!newPassword) {
                        this.showToastMessage('Please enter a password', 'error');
                        return;
                    }
                    
                    localStorage.setItem('sec_password', newPassword);
                    document.getElementById('sec_pass').value = '';
                    this.showToastMessage('Secretary password updated!', 'success');
                },
                
                backupData() {
                    const backup = {
                        properties: this.properties,
                        payments: this.payments,
                        expenses: this.expenses,
                        settings: this.settings,
                        commissionRate: this.commissionRate,
                        timestamp: new Date().toISOString()
                    };
                    
                    const dataStr = JSON.stringify(backup, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `eagle-homes-backup-${new Date().toISOString().slice(0, 10)}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    this.showToastMessage('Backup created successfully', 'success');
                },
                
                restoreData() {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';
                    
                    input.onchange = e => {
                        const file = e.target.files[0];
                        const reader = new FileReader();
                        
                        reader.onload = (event) => {
                            try {
                                const backup = JSON.parse(event.target.result);
                                this.properties = backup.properties || {};
                                this.payments = backup.payments || [];
                                this.expenses = backup.expenses || [];
                                this.settings = backup.settings || this.settings;
                                this.commissionRate = backup.commissionRate || 0.10;
                                
                                this.saveData();
                                localStorage.setItem('eagle_expenses', JSON.stringify(this.expenses));
                                localStorage.setItem('commissionRate', this.commissionRate.toString());
                                this.showToastMessage('Data restored successfully', 'success');
                                setTimeout(() => location.reload(), 1000);
                            } catch (error) {
                                this.showToastMessage('Failed to restore backup', 'error');
                            }
                        };
                        
                        reader.readAsText(file);
                    };
                    
                    input.click();
                },
                
                clearAllData() {
                    if (confirm('WARNING: This will delete ALL data. Are you absolutely sure?')) {
                        localStorage.clear();
                        this.showToastMessage('All data cleared. Refreshing...', 'success');
                        setTimeout(() => location.reload(), 1000);
                    }
                },
                
                // Password Reset Functions
                async sendResetRequest() {
                    if (!this.resetEmail) {
                        this.showToastMessage('Please enter your email', 'error');
                        return;
                    }
                    
                    this.isSending = true;

                    // EmailJS Integration - You need to sign up at emailjs.com
                    // and replace these with your actual credentials
                    const templateParams = {
                        to_email: 'eaglehomesagencies4@gmail.com',
                        from_name: 'Eagle Homes System',
                        user_requesting: this.resetEmail,
                        message: `A password reset has been requested for account: ${this.resetEmail}. Please log in to the Master Admin panel to generate a temporary password.`
                    };

                    try {
                        // Simulating API call
                        console.log('Sending reset request to eaglehomesagencies4@gmail.com...');
                        
                        // For production, uncomment and configure EmailJS:
                        // emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', templateParams)
                        
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        
                        alert('Reset request sent! The administrator at eaglehomesagencies4@gmail.com has been notified to reset your credentials.');
                        this.showResetModal = false;
                        this.resetEmail = '';
                    } catch (error) {
                        alert('System Error: Could not send request. Please contact administrator directly.');
                    } finally {
                        this.isSending = false;
                    }
                },
                
                // Helper Functions
                calculatePropertyTotal(propertyName, field) {
                    const property = this.properties[propertyName];
                    if (!property) return 0;
                    return property.reduce((sum, unit) => sum + (unit[field] || 0), 0);
                },
                
                calculateOccupancyRate(propertyName) {
                    const property = this.properties[propertyName];
                    if (!property || property.length === 0) return 0;
                    const occupied = property.filter(u => u.status === 'occupied').length;
                    return Math.round((occupied / property.length) * 100);
                },
                
                countVacantUnits(propertyName) {
                    const property = this.properties[propertyName];
                    if (!property) return 0;
                    return property.filter(u => u.status === 'vacant').length;
                },
                
                formatNumber(num) {
                    return new Intl.NumberFormat('en-KE').format(num);
                },
                
                getStatusClass(status) {
                    const classes = {
                        occupied: 'bg-green-100 text-green-800',
                        vacant: 'bg-red-100 text-red-800',
                        landlord: 'bg-purple-100 text-purple-800',
                        staff: 'bg-amber-100 text-amber-800'
                    };
                    return classes[status] || 'bg-gray-100 text-gray-800';
                },
                
                getStatusText(status) {
                    const texts = {
                        occupied: 'Occupied',
                        vacant: 'Vacant',
                        landlord: 'Landlord',
                        staff: 'Staff'
                    };
                    return texts[status] || status;
                },
                
                getUtilityStatusClass(unit) {
                    if (unit.water && unit.electricity) {
                        return 'bg-green-100 text-green-800';
                    } else if (unit.water || unit.electricity) {
                        return 'bg-amber-100 text-amber-800';
                    } else {
                        return 'bg-gray-100 text-gray-800';
                    }
                },
                
                getUtilityStatusText(unit) {
                    if (unit.water && unit.electricity) {
                        return 'Complete';
                    } else if (unit.water || unit.electricity) {
                        return 'Partial';
                    } else {
                        return 'Pending';
                    }
                },
                
                getPaymentMethodClass(method) {
                    const classes = {
                        mpesa: 'bg-green-100 text-green-800',
                        bank: 'bg-blue-100 text-blue-800',
                        cash: 'bg-emerald-100 text-emerald-800'
                    };
                    return classes[method.toLowerCase()] || 'bg-gray-100 text-gray-800';
                },
                
                getPaymentStatusClass(status) {
                    const classes = {
                        paid: 'bg-green-100 text-green-800',
                        pending: 'bg-amber-100 text-amber-800',
                        overdue: 'bg-red-100 text-red-800'
                    };
                    return classes[status.toLowerCase()] || 'bg-gray-100 text-gray-800';
                },
                
                getActivityClass(type) {
                    if (type.includes('Payment') || type.includes('paid')) {
                        return 'bg-green-100 text-green-800';
                    } else if (type.includes('Occupied')) {
                        return 'bg-blue-100 text-blue-800';
                    } else if (type.includes('Vacant')) {
                        return 'bg-red-100 text-red-800';
                    } else {
                        return 'bg-gray-100 text-gray-800';
                    }
                },
                
                // Data Persistence
                saveData() {
                    localStorage.setItem('eagle_properties', JSON.stringify(this.properties));
                    localStorage.setItem('eagle_payments', JSON.stringify(this.payments));
                    localStorage.setItem('eagle_settings', JSON.stringify(this.settings));
                    localStorage.setItem('userRole', this.userRole);
                },
                
                exportData() {
                    const data = {
                        properties: this.properties,
                        tenants: this.allTenants,
                        payments: this.payments,
                        expenses: this.expenses,
                        settings: this.settings,
                        timestamp: new Date().toISOString()
                    };
                    
                    const dataStr = JSON.stringify(data, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `eagle-homes-data-${new Date().toISOString().slice(0, 10)}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    this.showToastMessage('Data exported successfully', 'success');
                },
                
                exportUtilityData() {
                    const data = {
                        month: this.utilityMonth,
                        property: this.selectedProperty,
                        units: this.utilityUnits,
                        totals: {
                            water: this.utilityUnits.reduce((sum, u) => sum + (parseFloat(u.water) || 0), 0),
                            electricity: this.utilityUnits.reduce((sum, u) => sum + (parseFloat(u.electricity) || 0), 0),
                            garbage: this.utilityUnits.reduce((sum, u) => sum + (parseFloat(u.garbage) || 0), 0),
                            totalBill: this.totalUtilityBill
                        }
                    };
                    
                    const dataStr = JSON.stringify(data, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `utility-data-${this.selectedProperty}-${this.utilityMonth}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    this.showToastMessage('Utility data exported', 'success');
                },
                
                exportPropertiesData() {
                    this.exportData();
                },
                
                exportPayments() {
                    const data = {
                        payments: this.payments,
                        summary: {
                            totalCollected: this.totalCollected,
                            totalPending: this.totalPending,
                            collectionRate: this.collectionRate
                        },
                        timestamp: new Date().toISOString()
                    };
                    
                    const dataStr = JSON.stringify(data, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `payments-data-${new Date().toISOString().slice(0, 10)}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    this.showToastMessage('Payments exported', 'success');
                },
                
                generateMonthlyReport() {
                    this.generateReport();
                },
                
                printReport() {
                    window.print();
                },
                
                printFinancialReport() {
                    this.generateReport();
                    setTimeout(() => window.print(), 500);
                },
                
                // User Management
                onRoleChange() {
                    localStorage.setItem('userRole', this.userRole);
                    this.showToastMessage(`Switched to ${this.userRole} role`, 'success');
                },
                
                logout() {
                    if (confirm('Are you sure you want to logout?')) {
                        localStorage.removeItem('userRole');
                        window.location.href = 'index.html'; // This would be your login page
                    }
                },
                
                // Toast Notification
                showToastMessage(message, type = 'success') {
                    this.toastMessage = message;
                    this.toastType = type;
                    this.showToast = true;
                    
                    setTimeout(() => {
                        this.showToast = false;
                    }, 3000);
                }
            };
        }
    </script>
</body>
</html>
